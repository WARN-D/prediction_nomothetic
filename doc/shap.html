<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 SHAP | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study</title>
  <meta name="description" content="11 SHAP | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="11 SHAP | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 SHAP | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  
  
  

<meta name="author" content="Rayyan Tutunji" />


<meta name="date" content="2025-11-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="idiographic-model-performance.html"/>
<link rel="next" href="supp-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-prep.html"><a href="data-prep.html"><i class="fa fa-check"></i><b>2</b> Data Prep</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-prep.html"><a href="data-prep.html#processing"><i class="fa fa-check"></i><b>2.1</b> Processing</a></li>
<li class="chapter" data-level="2.2" data-path="data-prep.html"><a href="data-prep.html#compliance-estimates"><i class="fa fa-check"></i><b>2.2</b> Compliance Estimates</a></li>
<li class="chapter" data-level="2.3" data-path="data-prep.html"><a href="data-prep.html#data-merger"><i class="fa fa-check"></i><b>2.3</b> Data Merger</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="descriptives.html"><a href="descriptives.html"><i class="fa fa-check"></i><b>3</b> Descriptives</a>
<ul>
<li class="chapter" data-level="" data-path="descriptives.html"><a href="descriptives.html#demographics"><i class="fa fa-check"></i>Demographics</a></li>
<li class="chapter" data-level="" data-path="descriptives.html"><a href="descriptives.html#compliance-rates"><i class="fa fa-check"></i>Compliance Rates</a></li>
<li class="chapter" data-level="" data-path="descriptives.html"><a href="descriptives.html#feature-correlations"><i class="fa fa-check"></i>Feature Correlations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="imputation.html"><a href="imputation.html"><i class="fa fa-check"></i><b>4</b> Imputation</a></li>
<li class="chapter" data-level="5" data-path="dataset-creation.html"><a href="dataset-creation.html"><i class="fa fa-check"></i><b>5</b> Dataset Creation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dataset-creation.html"><a href="dataset-creation.html#weekly-data"><i class="fa fa-check"></i><b>5.1</b> Weekly Data</a></li>
<li class="chapter" data-level="5.2" data-path="dataset-creation.html"><a href="dataset-creation.html#daily-data"><i class="fa fa-check"></i><b>5.2</b> Daily Data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dataset-export.html"><a href="dataset-export.html"><i class="fa fa-check"></i><b>6</b> Dataset Export</a></li>
<li class="chapter" data-level="7" data-path="model-testing.html"><a href="model-testing.html"><i class="fa fa-check"></i><b>7</b> Model Testing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="model-testing.html"><a href="model-testing.html#model-predictions"><i class="fa fa-check"></i><b>7.1</b> Model Predictions</a></li>
<li class="chapter" data-level="7.2" data-path="model-testing.html"><a href="model-testing.html#shap-estimate"><i class="fa fa-check"></i><b>7.2</b> SHAP Estimate</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>8</b> Results</a></li>
<li class="chapter" data-level="9" data-path="model-performance.html"><a href="model-performance.html"><i class="fa fa-check"></i><b>9</b> Model Performance</a>
<ul>
<li class="chapter" data-level="" data-path="model-performance.html"><a href="model-performance.html#training-cv"><i class="fa fa-check"></i>Training CV</a></li>
<li class="chapter" data-level="" data-path="model-performance.html"><a href="model-performance.html#test-data"><i class="fa fa-check"></i>Test Data</a></li>
<li class="chapter" data-level="9.1" data-path="model-performance.html"><a href="model-performance.html#full-results"><i class="fa fa-check"></i><b>9.1</b> Full Results</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="idiographic-model-performance.html"><a href="idiographic-model-performance.html"><i class="fa fa-check"></i><b>10</b> Idiographic Model Performance</a></li>
<li class="chapter" data-level="11" data-path="shap.html"><a href="shap.html"><i class="fa fa-check"></i><b>11</b> SHAP</a>
<ul>
<li class="chapter" data-level="" data-path="shap.html"><a href="shap.html#top-10-daily"><i class="fa fa-check"></i>Top 10 Daily</a></li>
<li class="chapter" data-level="11.1" data-path="shap.html"><a href="shap.html#top-10-weekly"><i class="fa fa-check"></i><b>11.1</b> Top 10 Weekly</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="supp-analysis.html"><a href="supp-analysis.html"><i class="fa fa-check"></i><b>12</b> Supp Analysis</a>
<ul>
<li class="chapter" data-level="12.1" data-path="supp-analysis.html"><a href="supp-analysis.html#phq-9-autoregressive-model"><i class="fa fa-check"></i><b>12.1</b> PHQ-9 Autoregressive Model</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shap" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> SHAP<a href="shap.html#shap" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Now I estimate the SHAP plots for feature contributions. I wrap this into a function that lets me plot a bit more easily and keep some visual consistency. The funciton will filter the data to reduce overhead memory usage, rank the SHAP values based on the absolute SHAP values, and then filter and plot the top 10 features. I do the data loading after setting-up the function to read all the SHAP values.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="shap.html#cb60-1" tabindex="-1"></a><span class="co"># Plotting functions</span></span>
<span id="cb60-2"><a href="shap.html#cb60-2" tabindex="-1"></a>shap_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(shap_values, <span class="at">models=</span><span class="st">&#39;week&#39;</span>, <span class="at">sources=</span><span class="st">&#39;ema&#39;</span>, <span class="at">feats =</span> <span class="dv">10</span>, <span class="at">x_range=</span><span class="fl">0.5</span>){</span>
<span id="cb60-3"><a href="shap.html#cb60-3" tabindex="-1"></a>  </span>
<span id="cb60-4"><a href="shap.html#cb60-4" tabindex="-1"></a>  <span class="co"># Filter and estimate abs values</span></span>
<span id="cb60-5"><a href="shap.html#cb60-5" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> shap_values[model <span class="sc">==</span> models <span class="sc">&amp;</span> source <span class="sc">==</span> sources]</span>
<span id="cb60-6"><a href="shap.html#cb60-6" tabindex="-1"></a>  df_temp[, shap_mean <span class="sc">:=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shap_fold_avg)), by <span class="ot">=</span> feature]</span>
<span id="cb60-7"><a href="shap.html#cb60-7" tabindex="-1"></a>  df_temp[, shap_order <span class="sc">:=</span> <span class="fu">frank</span>(<span class="sc">-</span><span class="fu">abs</span>(shap_mean), <span class="at">ties.method =</span> <span class="st">&quot;dense&quot;</span>)]</span>
<span id="cb60-8"><a href="shap.html#cb60-8" tabindex="-1"></a>  df_temp[, shap_order <span class="sc">:=</span> shap_order<span class="dv">-1</span>]</span>
<span id="cb60-9"><a href="shap.html#cb60-9" tabindex="-1"></a>  </span>
<span id="cb60-10"><a href="shap.html#cb60-10" tabindex="-1"></a>  <span class="co"># Keep top features</span></span>
<span id="cb60-11"><a href="shap.html#cb60-11" tabindex="-1"></a>  df_temp_top <span class="ot">&lt;-</span> df_temp[shap_order <span class="sc">&lt;=</span> feats<span class="dv">-1</span>]</span>
<span id="cb60-12"><a href="shap.html#cb60-12" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(df_temp_top<span class="sc">$</span>feature_labs)</span>
<span id="cb60-13"><a href="shap.html#cb60-13" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">fct_rev</span>(<span class="fu">factor</span>(df_temp_top<span class="sc">$</span>feature_labs,</span>
<span id="cb60-14"><a href="shap.html#cb60-14" tabindex="-1"></a>                                     <span class="at">levels =</span> <span class="fu">unique</span>(df_temp_top[<span class="fu">order</span>(shap_order)]<span class="sc">$</span>feature_labs)))</span>
<span id="cb60-15"><a href="shap.html#cb60-15" tabindex="-1"></a>  </span>
<span id="cb60-16"><a href="shap.html#cb60-16" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb60-17"><a href="shap.html#cb60-17" tabindex="-1"></a>  plot <span class="ot">=</span> <span class="fu">ggplot</span>(df_temp_top, <span class="fu">aes</span>(<span class="at">x=</span>shap_fold_avg, <span class="at">y =</span> feature_labs)) <span class="sc">+</span> </span>
<span id="cb60-18"><a href="shap.html#cb60-18" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb60-19"><a href="shap.html#cb60-19" tabindex="-1"></a>    <span class="fu">geom_quasirandom</span>(<span class="fu">aes</span>(<span class="at">color =</span> shap_fold_avg), <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb60-20"><a href="shap.html#cb60-20" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>( <span class="at">limits =</span> <span class="fu">levels</span>(df_temp_top<span class="sc">$</span>feature_labs),</span>
<span id="cb60-21"><a href="shap.html#cb60-21" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">levels</span>(df_temp_top<span class="sc">$</span>feature_labs)) <span class="sc">+</span></span>
<span id="cb60-22"><a href="shap.html#cb60-22" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span><span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb60-23"><a href="shap.html#cb60-23" tabindex="-1"></a>    <span class="fu">scale_color_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">mid=</span><span class="st">&#39;yellow&#39;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb60-24"><a href="shap.html#cb60-24" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> <span class="st">&quot;SHAP Values&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-25"><a href="shap.html#cb60-25" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb60-26"><a href="shap.html#cb60-26" tabindex="-1"></a>    <span class="fu">theme</span>( <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">7</span>),</span>
<span id="cb60-27"><a href="shap.html#cb60-27" tabindex="-1"></a>           <span class="at">legend.position=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb60-28"><a href="shap.html#cb60-28" tabindex="-1"></a>           <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;SegoeSymb&quot;</span>, <span class="at">size=</span><span class="fl">6.5</span>, <span class="at">angle=</span><span class="dv">45</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">l=</span><span class="dv">25</span>)),</span>
<span id="cb60-29"><a href="shap.html#cb60-29" tabindex="-1"></a>           <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t=</span><span class="dv">10</span>, <span class="at">b=</span><span class="dv">10</span>)), </span>
<span id="cb60-30"><a href="shap.html#cb60-30" tabindex="-1"></a>           <span class="at">axis.text.x =</span> <span class="fu">element_text</span>( <span class="at">size=</span><span class="fl">6.5</span>)) <span class="sc">+</span></span>
<span id="cb60-31"><a href="shap.html#cb60-31" tabindex="-1"></a>    </span>
<span id="cb60-32"><a href="shap.html#cb60-32" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span>x_range,x_range)) </span>
<span id="cb60-33"><a href="shap.html#cb60-33" tabindex="-1"></a>    </span>
<span id="cb60-34"><a href="shap.html#cb60-34" tabindex="-1"></a>  </span>
<span id="cb60-35"><a href="shap.html#cb60-35" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb60-36"><a href="shap.html#cb60-36" tabindex="-1"></a>}</span>
<span id="cb60-37"><a href="shap.html#cb60-37" tabindex="-1"></a></span>
<span id="cb60-38"><a href="shap.html#cb60-38" tabindex="-1"></a></span>
<span id="cb60-39"><a href="shap.html#cb60-39" tabindex="-1"></a>shap_plot_ts<span class="ot">&lt;-</span> <span class="cf">function</span>(shap_values, models, sources){</span>
<span id="cb60-40"><a href="shap.html#cb60-40" tabindex="-1"></a>  </span>
<span id="cb60-41"><a href="shap.html#cb60-41" tabindex="-1"></a>  <span class="co"># Filter and estimate abs values</span></span>
<span id="cb60-42"><a href="shap.html#cb60-42" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> shap_values[model <span class="sc">==</span> models <span class="sc">&amp;</span> source <span class="sc">==</span> sources]</span>
<span id="cb60-43"><a href="shap.html#cb60-43" tabindex="-1"></a>  df_temp[, shap_mean <span class="sc">:=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shap_fold_avg)), by <span class="ot">=</span> feature]</span>
<span id="cb60-44"><a href="shap.html#cb60-44" tabindex="-1"></a>  df_temp[, shap_order <span class="sc">:=</span> <span class="fu">frank</span>(<span class="sc">-</span><span class="fu">abs</span>(shap_mean), <span class="at">ties.method =</span> <span class="st">&quot;dense&quot;</span>)]</span>
<span id="cb60-45"><a href="shap.html#cb60-45" tabindex="-1"></a>  df_temp[,step <span class="sc">:=</span> step]</span>
<span id="cb60-46"><a href="shap.html#cb60-46" tabindex="-1"></a>  </span>
<span id="cb60-47"><a href="shap.html#cb60-47" tabindex="-1"></a>  <span class="co"># Keep top features</span></span>
<span id="cb60-48"><a href="shap.html#cb60-48" tabindex="-1"></a>  df_temp_top <span class="ot">&lt;-</span> df_temp[shap_order <span class="sc">&lt;=</span> <span class="dv">10</span>]</span>
<span id="cb60-49"><a href="shap.html#cb60-49" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(df_temp_top<span class="sc">$</span>feature_labs)</span>
<span id="cb60-50"><a href="shap.html#cb60-50" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_temp_top<span class="sc">$</span>feature_labs,</span>
<span id="cb60-51"><a href="shap.html#cb60-51" tabindex="-1"></a>                                     <span class="at">levels =</span> <span class="fu">unique</span>(df_temp_top[<span class="fu">order</span>(shap_order)]<span class="sc">$</span>feature_labs))</span>
<span id="cb60-52"><a href="shap.html#cb60-52" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb60-53"><a href="shap.html#cb60-53" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_temp_top, <span class="fu">aes</span>(<span class="at">x=</span>step, <span class="at">y =</span> shap_fold_avg)) <span class="sc">+</span> </span>
<span id="cb60-54"><a href="shap.html#cb60-54" tabindex="-1"></a>     <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb60-55"><a href="shap.html#cb60-55" tabindex="-1"></a>     <span class="fu">geom_quasirandom</span>(<span class="fu">aes</span>(<span class="at">color =</span> shap_fold_avg), <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb60-56"><a href="shap.html#cb60-56" tabindex="-1"></a>      <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb60-57"><a href="shap.html#cb60-57" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;SHAP Values&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Time Steps&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-58"><a href="shap.html#cb60-58" tabindex="-1"></a>     <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb60-59"><a href="shap.html#cb60-59" tabindex="-1"></a>     <span class="fu">theme</span>( <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb60-60"><a href="shap.html#cb60-60" tabindex="-1"></a>            <span class="at">legend.position=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb60-61"><a href="shap.html#cb60-61" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>),</span>
<span id="cb60-62"><a href="shap.html#cb60-62" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">21</span>),</span>
<span id="cb60-63"><a href="shap.html#cb60-63" tabindex="-1"></a>            <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;SegoeSymb&quot;</span>, <span class="at">size=</span><span class="dv">21</span>)) <span class="sc">+</span></span>
<span id="cb60-64"><a href="shap.html#cb60-64" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(feature_labs<span class="sc">~</span>., <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb60-65"><a href="shap.html#cb60-65" tabindex="-1"></a>  </span>
<span id="cb60-66"><a href="shap.html#cb60-66" tabindex="-1"></a>  <span class="fu">return</span>(plot) </span>
<span id="cb60-67"><a href="shap.html#cb60-67" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="shap.html#cb61-1" tabindex="-1"></a><span class="co"># Read in the Python Estimated SHAP values</span></span>
<span id="cb61-2"><a href="shap.html#cb61-2" tabindex="-1"></a>shap_values <span class="ot">=</span> <span class="fu">Sys.glob</span>(<span class="st">&quot;C:/Users/rayya/Nextcloud/FSW_WARN-D (Projectfolder)/group/raytut/projects/prediction_nomothetic/results/shap_values_*.csv&quot;</span>)</span>
<span id="cb61-3"><a href="shap.html#cb61-3" tabindex="-1"></a>shap_values <span class="ot">=</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(shap_values, fread), <span class="at">fill=</span>T)</span>
<span id="cb61-4"><a href="shap.html#cb61-4" tabindex="-1"></a><span class="fu">setDT</span>(shap_values)</span>
<span id="cb61-5"><a href="shap.html#cb61-5" tabindex="-1"></a></span>
<span id="cb61-6"><a href="shap.html#cb61-6" tabindex="-1"></a><span class="co"># Convert to a long dataframe</span></span>
<span id="cb61-7"><a href="shap.html#cb61-7" tabindex="-1"></a>shap_values <span class="ot">&lt;-</span> <span class="fu">melt</span>(shap_values,</span>
<span id="cb61-8"><a href="shap.html#cb61-8" tabindex="-1"></a>                    <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;step&quot;</span>, <span class="st">&quot;fold&quot;</span>, <span class="st">&quot;source&quot;</span>, <span class="st">&quot;model&quot;</span>), </span>
<span id="cb61-9"><a href="shap.html#cb61-9" tabindex="-1"></a>                    <span class="at">variable.name =</span> <span class="st">&quot;feature&quot;</span>, <span class="at">value.name =</span> <span class="st">&quot;shap&quot;</span>)</span>
<span id="cb61-10"><a href="shap.html#cb61-10" tabindex="-1"></a>  </span>
<span id="cb61-11"><a href="shap.html#cb61-11" tabindex="-1"></a><span class="co"># Average across folds</span></span>
<span id="cb61-12"><a href="shap.html#cb61-12" tabindex="-1"></a>shap_values[, shap_fold_avg <span class="sc">:=</span> <span class="fu">mean</span>(shap, <span class="at">na.rm=</span>T), by <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;sample&#39;</span>, <span class="st">&#39;step&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;feature&#39;</span>)]</span>
<span id="cb61-13"><a href="shap.html#cb61-13" tabindex="-1"></a>shap_values[, fold <span class="sc">:=</span> <span class="cn">NULL</span>]</span>
<span id="cb61-14"><a href="shap.html#cb61-14" tabindex="-1"></a>shap_values[, shap <span class="sc">:=</span> <span class="cn">NULL</span>]</span>
<span id="cb61-15"><a href="shap.html#cb61-15" tabindex="-1"></a>shap_values <span class="ot">&lt;-</span> <span class="fu">unique</span>(shap_values)</span>
<span id="cb61-16"><a href="shap.html#cb61-16" tabindex="-1"></a></span>
<span id="cb61-17"><a href="shap.html#cb61-17" tabindex="-1"></a><span class="co"># Make prettier labels</span></span>
<span id="cb61-18"><a href="shap.html#cb61-18" tabindex="-1"></a>variable_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-19"><a href="shap.html#cb61-19" tabindex="-1"></a>  <span class="st">&quot;sleep_qual_m&quot;</span>, <span class="st">&quot;sleep_rest_m&quot;</span>, <span class="st">&quot;outlook_m&quot;</span>,</span>
<span id="cb61-20"><a href="shap.html#cb61-20" tabindex="-1"></a>  <span class="st">&quot;overwhelm_d&quot;</span>, <span class="st">&quot;motivated_d&quot;</span>, <span class="st">&quot;stressed_d&quot;</span>, <span class="st">&quot;ruminate_d&quot;</span>, <span class="st">&quot;tired_d&quot;</span>, <span class="st">&quot;nervous_d&quot;</span>, <span class="st">&quot;sad_d&quot;</span>, <span class="st">&quot;relaxed_d&quot;</span>, <span class="st">&quot;cheerful_d&quot;</span>, <span class="st">&quot;irritable_d&quot;</span>,</span>
<span id="cb61-21"><a href="shap.html#cb61-21" tabindex="-1"></a>  <span class="st">&quot;activity_enjoy_d&quot;</span>, <span class="st">&quot;offline_enjoy_d&quot;</span>, <span class="st">&quot;online_enjoy_d&quot;</span>, </span>
<span id="cb61-22"><a href="shap.html#cb61-22" tabindex="-1"></a>  <span class="st">&quot;discomfort_e&quot;</span>, <span class="st">&quot;emo_reg_e&quot;</span>, <span class="st">&quot;useful_e&quot;</span>, <span class="st">&quot;neg_exp_e&quot;</span>, <span class="st">&quot;pos_exp_e&quot;</span>,</span>
<span id="cb61-23"><a href="shap.html#cb61-23" tabindex="-1"></a>  <span class="st">&quot;neg_exp_cat_e_1&quot;</span>, <span class="st">&quot;neg_exp_cat_e_2&quot;</span>, <span class="st">&quot;neg_exp_cat_e_3&quot;</span>, <span class="st">&quot;neg_exp_cat_e_10&quot;</span>,</span>
<span id="cb61-24"><a href="shap.html#cb61-24" tabindex="-1"></a>  <span class="st">&quot;neg_exp_cat_e_4&quot;</span>, <span class="st">&quot;neg_exp_cat_e_5&quot;</span>, <span class="st">&quot;neg_exp_cat_e_6&quot;</span>, <span class="st">&quot;neg_exp_cat_e_11&quot;</span>,</span>
<span id="cb61-25"><a href="shap.html#cb61-25" tabindex="-1"></a>  <span class="st">&quot;neg_exp_cat_e_7&quot;</span>, <span class="st">&quot;neg_exp_cat_e_8&quot;</span>, <span class="st">&quot;neg_exp_cat_e_12&quot;</span>, </span>
<span id="cb61-26"><a href="shap.html#cb61-26" tabindex="-1"></a>  <span class="st">&quot;pos_exp_cat_e_1&quot;</span>, <span class="st">&quot;pos_exp_cat_e_2&quot;</span>, <span class="st">&quot;pos_exp_cat_e_3&quot;</span>, <span class="st">&quot;pos_exp_cat_e_10&quot;</span>,</span>
<span id="cb61-27"><a href="shap.html#cb61-27" tabindex="-1"></a>  <span class="st">&quot;pos_exp_cat_e_4&quot;</span>, <span class="st">&quot;pos_exp_cat_e_5&quot;</span>, <span class="st">&quot;pos_exp_cat_e_6&quot;</span>, <span class="st">&quot;pos_exp_cat_e_11&quot;</span>,</span>
<span id="cb61-28"><a href="shap.html#cb61-28" tabindex="-1"></a>  <span class="st">&quot;pos_exp_cat_e_7&quot;</span>, <span class="st">&quot;pos_exp_cat_e_8&quot;</span>, <span class="st">&quot;pos_exp_cat_e_12&quot;</span>,</span>
<span id="cb61-29"><a href="shap.html#cb61-29" tabindex="-1"></a>  <span class="st">&quot;substance_e_1&quot;</span>, <span class="st">&quot;substance_e_2&quot;</span>, <span class="st">&quot;substance_e_3&quot;</span>, <span class="st">&quot;substance_e_4&quot;</span>, <span class="st">&quot;substance_e_5&quot;</span>, <span class="st">&quot;substance_e_6&quot;</span>, </span>
<span id="cb61-30"><a href="shap.html#cb61-30" tabindex="-1"></a>  <span class="st">&quot;substance_e_7&quot;</span>, <span class="st">&quot;substance_e_8&quot;</span>, <span class="st">&quot;substance_e_9&quot;</span>,</span>
<span id="cb61-31"><a href="shap.html#cb61-31" tabindex="-1"></a>  <span class="st">&quot;hr_mean&quot;</span>, <span class="st">&quot;hr_min&quot;</span>, <span class="st">&quot;hr_max&quot;</span>, <span class="st">&quot;hr_sd&quot;</span>, </span>
<span id="cb61-32"><a href="shap.html#cb61-32" tabindex="-1"></a>  <span class="st">&quot;stress_mean&quot;</span>, <span class="st">&quot;stress_sd&quot;</span>, <span class="st">&quot;stress_min&quot;</span>, <span class="st">&quot;stress_max&quot;</span>,</span>
<span id="cb61-33"><a href="shap.html#cb61-33" tabindex="-1"></a>  <span class="st">&quot;intraday_activity_cals&quot;</span>, <span class="st">&quot;intraday_steps&quot;</span>, <span class="st">&quot;intraday_active_seconds&quot;</span>, </span>
<span id="cb61-34"><a href="shap.html#cb61-34" tabindex="-1"></a>  <span class="st">&quot;intraday_met_value&quot;</span>, <span class="st">&quot;intraday_intensity_mean&quot;</span>, <span class="st">&quot;intraday_intensity_max&quot;</span>, </span>
<span id="cb61-35"><a href="shap.html#cb61-35" tabindex="-1"></a>  <span class="st">&quot;body_bat_mean&quot;</span>, <span class="st">&quot;body_bat_sd&quot;</span>, <span class="st">&quot;body_bat_min&quot;</span>, <span class="st">&quot;body_bat_max&quot;</span>, </span>
<span id="cb61-36"><a href="shap.html#cb61-36" tabindex="-1"></a>  <span class="st">&quot;sleep_hr_mean&quot;</span>, <span class="st">&quot;sleep_hr_median&quot;</span>, <span class="st">&quot;sleep_hr_skew&quot;</span>, <span class="st">&quot;sleep_hr_kurt&quot;</span>, </span>
<span id="cb61-37"><a href="shap.html#cb61-37" tabindex="-1"></a>  <span class="st">&quot;sleep_hr_min&quot;</span>, <span class="st">&quot;sleep_hr_max&quot;</span>, <span class="st">&quot;sleep_hr_sd&quot;</span>, <span class="st">&quot;sleep_start&quot;</span>, </span>
<span id="cb61-38"><a href="shap.html#cb61-38" tabindex="-1"></a>  <span class="st">&quot;sleep_end&quot;</span>, <span class="st">&quot;sleep_dur_tot_s&quot;</span></span>
<span id="cb61-39"><a href="shap.html#cb61-39" tabindex="-1"></a>  )</span>
<span id="cb61-40"><a href="shap.html#cb61-40" tabindex="-1"></a></span>
<span id="cb61-41"><a href="shap.html#cb61-41" tabindex="-1"></a><span class="co"># Have to them one line at a time unfortsh</span></span>
<span id="cb61-42"><a href="shap.html#cb61-42" tabindex="-1"></a>variable_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-43"><a href="shap.html#cb61-43" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep Quality&quot;</span>,<span class="st">&quot;ğŸ›Rested&quot;</span>, <span class="st">&quot;ğŸ›Outlook&quot;</span>,</span>
<span id="cb61-44"><a href="shap.html#cb61-44" tabindex="-1"></a>  <span class="st">&quot;â˜€Overwhelm&quot;</span>, <span class="st">&quot;â˜€Motivated&quot;</span>, <span class="st">&quot;â˜€Stressed&quot;</span>, <span class="st">&quot;â˜€Ruminate&quot;</span>, <span class="st">&quot;â˜€Tired&quot;</span>,<span class="st">&quot;â˜€Nervous&quot;</span>, </span>
<span id="cb61-45"><a href="shap.html#cb61-45" tabindex="-1"></a>  <span class="st">&quot;â˜€Sad&quot;</span>, <span class="st">&quot;â˜€Relaxed&quot;</span>, <span class="st">&quot;â˜€Cheerful&quot;</span>, <span class="st">&quot;â˜€Irritable&quot;</span>, <span class="st">&quot;â˜€Activity&quot;</span>, <span class="st">&quot;â˜€Social (offline)&quot;</span>, <span class="st">&quot;â˜€Social (online)&quot;</span>, </span>
<span id="cb61-46"><a href="shap.html#cb61-46" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Discomfort&quot;</span>, <span class="st">&quot;ğŸŒ™Emo. Regulation&quot;</span>, <span class="st">&quot;ğŸŒ™Useful&quot;</span>,</span>
<span id="cb61-47"><a href="shap.html#cb61-47" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Neg. Experience&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Experience&quot;</span>, <span class="st">&quot;ğŸŒ™Neg. Wellbeing (Phys)&quot;</span>,</span>
<span id="cb61-48"><a href="shap.html#cb61-48" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Neg. Wellbeing (Ment)&quot;</span>, <span class="st">&quot;ğŸŒ™Neg. Finances&quot;</span>, <span class="st">&quot;ğŸŒ™Neg. Education/Work&quot;</span>,</span>
<span id="cb61-49"><a href="shap.html#cb61-49" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Neg. Home&quot;</span>,  <span class="st">&quot;ğŸŒ™Neg. Leisure&quot;</span>, <span class="st">&quot;ğŸŒ™Neg. Love Life&quot;</span>,</span>
<span id="cb61-50"><a href="shap.html#cb61-50" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Neg. Social Life&quot;</span>, <span class="st">&quot;ğŸŒ™Neg. Relationships (Family)&quot;</span>, <span class="st">&quot;ğŸŒ™Neg. Experiences (Friends/Family)&quot;</span>,</span>
<span id="cb61-51"><a href="shap.html#cb61-51" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Neg. Society/Politics&quot;</span>, </span>
<span id="cb61-52"><a href="shap.html#cb61-52" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Pos. Wellbeing (Phys)&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Wellbeing (Ment)&quot;</span>, <span class="st">&quot;ğŸŒ™Neg. Finances&quot;</span>, </span>
<span id="cb61-53"><a href="shap.html#cb61-53" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Pos. Education/Work&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Home&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Leisure&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Love Life&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Social Life&quot;</span>,</span>
<span id="cb61-54"><a href="shap.html#cb61-54" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Pos. Relationships (Family)&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Experiences (Friends/Family)&quot;</span>, <span class="st">&quot;ğŸŒ™Pos. Society/Politics&quot;</span>,</span>
<span id="cb61-55"><a href="shap.html#cb61-55" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Caffeine&quot;</span>, <span class="st">&quot;ğŸŒ™Tobacco&quot;</span>, <span class="st">&quot;ğŸŒ™Alcohol&quot;</span>, <span class="st">&quot;ğŸŒ™Cannabis&quot;</span>, </span>
<span id="cb61-56"><a href="shap.html#cb61-56" tabindex="-1"></a>  <span class="st">&quot;ğŸŒ™Ecstasy&quot;</span>, <span class="st">&quot;ğŸŒ™Amphetamines&quot;</span>, <span class="st">&quot;ğŸŒ™Cocaine&quot;</span>, <span class="st">&quot;ğŸŒ™ Other Subs.&quot;</span>, <span class="st">&quot;ğŸŒ™No Subs.&quot;</span>, </span>
<span id="cb61-57"><a href="shap.html#cb61-57" tabindex="-1"></a>  <span class="st">&quot;ï¸â˜€HR MeanâŒš&quot;</span>,</span>
<span id="cb61-58"><a href="shap.html#cb61-58" tabindex="-1"></a>  <span class="st">&quot;â˜€HR MinâŒš&quot;</span>,</span>
<span id="cb61-59"><a href="shap.html#cb61-59" tabindex="-1"></a>  <span class="st">&quot;â˜€HR MaxâŒšï¸&quot;</span>, </span>
<span id="cb61-60"><a href="shap.html#cb61-60" tabindex="-1"></a>  <span class="st">&quot;â˜€HR SDâŒšï¸&quot;</span>, </span>
<span id="cb61-61"><a href="shap.html#cb61-61" tabindex="-1"></a>  <span class="st">&quot;â˜€Stress MeanâŒš&quot;</span>,</span>
<span id="cb61-62"><a href="shap.html#cb61-62" tabindex="-1"></a>  <span class="st">&quot;â˜€Stress SDâŒš&quot;</span>, <span class="st">&quot;â˜€Stress MinâŒš&quot;</span>, <span class="st">&quot;â˜€Stress MaxâŒšï¸&quot;</span>,  </span>
<span id="cb61-63"><a href="shap.html#cb61-63" tabindex="-1"></a>  <span class="st">&quot;â˜€CaloriesâŒš&quot;</span>, <span class="st">&quot;â˜€StepsâŒš&quot;</span>, <span class="st">&quot;â˜€Active Time (s)âŒš&quot;</span>, </span>
<span id="cb61-64"><a href="shap.html#cb61-64" tabindex="-1"></a>  <span class="st">&quot;â˜€MET ValueâŒš&quot;</span>,  <span class="st">&quot;â˜€Activity IntensityâŒš&quot;</span>, <span class="st">&quot;â˜€Maximum IntensityâŒš&quot;</span>, </span>
<span id="cb61-65"><a href="shap.html#cb61-65" tabindex="-1"></a>  <span class="st">&quot;â˜€Body Bat. MeanâŒšï¸&quot;</span>, <span class="st">&quot;â˜€Body Bat. SDâŒš&quot;</span>, <span class="st">&quot;â˜€Body Bat. MinâŒš&quot;</span>, <span class="st">&quot;â˜€Body Bat. MaxâŒš&quot;</span>, </span>
<span id="cb61-66"><a href="shap.html#cb61-66" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep HR MeanâŒšï¸&quot;</span>, </span>
<span id="cb61-67"><a href="shap.html#cb61-67" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep HR MedianâŒšï¸&quot;</span>, </span>
<span id="cb61-68"><a href="shap.html#cb61-68" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep HR SkewâŒšï¸&quot;</span>, </span>
<span id="cb61-69"><a href="shap.html#cb61-69" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep HR KurtosisâŒšï¸&quot;</span>, </span>
<span id="cb61-70"><a href="shap.html#cb61-70" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep HR MinâŒšï¸&quot;</span>, </span>
<span id="cb61-71"><a href="shap.html#cb61-71" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep HR MaxâŒšï¸&quot;</span>, </span>
<span id="cb61-72"><a href="shap.html#cb61-72" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep HR SDâŒšï¸&quot;</span>, </span>
<span id="cb61-73"><a href="shap.html#cb61-73" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep StartâŒšï¸&quot;</span>, </span>
<span id="cb61-74"><a href="shap.html#cb61-74" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep EndâŒš&quot;</span>, </span>
<span id="cb61-75"><a href="shap.html#cb61-75" tabindex="-1"></a>  <span class="st">&quot;ğŸ›Sleep DurationâŒšï¸&quot;</span>) </span>
<span id="cb61-76"><a href="shap.html#cb61-76" tabindex="-1"></a></span>
<span id="cb61-77"><a href="shap.html#cb61-77" tabindex="-1"></a><span class="co"># Make a label column for parsing</span></span>
<span id="cb61-78"><a href="shap.html#cb61-78" tabindex="-1"></a>shap_values<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">factor</span>(shap_values<span class="sc">$</span>feature, </span>
<span id="cb61-79"><a href="shap.html#cb61-79" tabindex="-1"></a>                                   <span class="at">levels=</span>variable_codes,</span>
<span id="cb61-80"><a href="shap.html#cb61-80" tabindex="-1"></a>                                   <span class="at">labels=</span>variable_labels)</span></code></pre></div>
<div id="top-10-daily" class="section level2 unnumbered hasAnchor">
<h2>Top 10 Daily<a href="shap.html#top-10-daily" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="shap.html#cb62-1" tabindex="-1"></a><span class="co"># Set up the three plots</span></span>
<span id="cb62-2"><a href="shap.html#cb62-2" tabindex="-1"></a>plot_d1 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;ema&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb62-3"><a href="shap.html#cb62-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartphone Self-Report (EMA)&quot;</span>)</span>
<span id="cb62-4"><a href="shap.html#cb62-4" tabindex="-1"></a>plot_d2 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;epa&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span>   </span>
<span id="cb62-5"><a href="shap.html#cb62-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartwatch Passive Sensing&quot;</span>) </span>
<span id="cb62-6"><a href="shap.html#cb62-6" tabindex="-1"></a>plot_d3 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;all&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span>   </span>
<span id="cb62-7"><a href="shap.html#cb62-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Combined Model&quot;</span>) </span>
<span id="cb62-8"><a href="shap.html#cb62-8" tabindex="-1"></a></span>
<span id="cb62-9"><a href="shap.html#cb62-9" tabindex="-1"></a><span class="co"># Arrange them and save em</span></span>
<span id="cb62-10"><a href="shap.html#cb62-10" tabindex="-1"></a>day_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(plot_d1, plot_d2, plot_d3, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`</code></pre>
<p><img src="final_report_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="shap.html#cb64-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_1_daily_mods.svg&quot;</span>, <span class="at">plot=</span>day_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb64-2"><a href="shap.html#cb64-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_1_daily_mods.png&quot;</span>, <span class="at">plot=</span>day_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
<p>Then we check the SHAP values per timestep.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="shap.html#cb65-1" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb65-2"><a href="shap.html#cb65-2" tabindex="-1"></a>plot_d_3_ts <span class="ot">&lt;-</span> <span class="fu">shap_plot_ts</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;all&quot;</span>)</span>
<span id="cb65-3"><a href="shap.html#cb65-3" tabindex="-1"></a>plot_d_3_ts</span></code></pre></div>
<p><img src="final_report_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="shap.html#cb66-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_daily_ts_shap.svg&quot;</span>, plot_d_3_ts, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>,<span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb66-2"><a href="shap.html#cb66-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_daily_ts_shap.png&quot;</span>, plot_d_3_ts, <span class="at">dpi=</span><span class="dv">900</span>,<span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>,<span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
</div>
<div id="top-10-weekly" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Top 10 Weekly<a href="shap.html#top-10-weekly" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Check the overall SHAP values</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="shap.html#cb67-1" tabindex="-1"></a><span class="co"># Set up the three plots</span></span>
<span id="cb67-2"><a href="shap.html#cb67-2" tabindex="-1"></a>plot_w1 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;ema&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb67-3"><a href="shap.html#cb67-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartphone Self-Report (EMA)&quot;</span>)</span>
<span id="cb67-4"><a href="shap.html#cb67-4" tabindex="-1"></a>plot_w2 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;epa&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb67-5"><a href="shap.html#cb67-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartwatch Passive Sensing&quot;</span>) </span>
<span id="cb67-6"><a href="shap.html#cb67-6" tabindex="-1"></a>plot_w3 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;all&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb67-7"><a href="shap.html#cb67-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Combined Model&quot;</span>) </span>
<span id="cb67-8"><a href="shap.html#cb67-8" tabindex="-1"></a></span>
<span id="cb67-9"><a href="shap.html#cb67-9" tabindex="-1"></a></span>
<span id="cb67-10"><a href="shap.html#cb67-10" tabindex="-1"></a><span class="co"># Arrange em and save em</span></span>
<span id="cb67-11"><a href="shap.html#cb67-11" tabindex="-1"></a>week_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(plot_w1, plot_w2, plot_w3, <span class="at">ncol =</span> <span class="dv">3</span>) </span></code></pre></div>
<pre><code>## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`</code></pre>
<p><img src="final_report_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="shap.html#cb69-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_2_weekly_mods.svg&quot;</span>, week_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb69-2"><a href="shap.html#cb69-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_2_weekly_mods.png&quot;</span>, week_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
<p>Now check the SHAP Values per timestep.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="shap.html#cb70-1" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb70-2"><a href="shap.html#cb70-2" tabindex="-1"></a>plot_w_3_ts <span class="ot">&lt;-</span> <span class="fu">shap_plot_ts</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;all&quot;</span>)</span>
<span id="cb70-3"><a href="shap.html#cb70-3" tabindex="-1"></a>plot_w_3_ts</span></code></pre></div>
<p><img src="final_report_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="shap.html#cb71-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_weekly_ts_shap.svg&quot;</span>, plot_w_3_ts, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb71-2"><a href="shap.html#cb71-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_weekly_ts_shap.png&quot;</span>, plot_w_3_ts, <span class="at">dpi=</span><span class="dv">900</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="idiographic-model-performance.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="supp-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
