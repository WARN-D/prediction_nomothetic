<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Data Prep | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study</title>
  <meta name="description" content="2 Data Prep | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Data Prep | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Data Prep | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  
  
  

<meta name="author" content="Rayyan Tutunji" />


<meta name="date" content="2025-11-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="model-testing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-prep.html"><a href="data-prep.html"><i class="fa fa-check"></i><b>2</b> Data Prep</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-prep.html"><a href="data-prep.html#processing"><i class="fa fa-check"></i><b>2.1</b> Processing</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-prep.html"><a href="data-prep.html#daily-features"><i class="fa fa-check"></i><b>2.1.1</b> Daily Features</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-prep.html"><a href="data-prep.html#morningevening-features"><i class="fa fa-check"></i><b>2.1.2</b> Morning/Evening Features</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-prep.html"><a href="data-prep.html#weekly-features"><i class="fa fa-check"></i><b>2.1.3</b> Weekly Features</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-prep.html"><a href="data-prep.html#compliance-estimates"><i class="fa fa-check"></i><b>2.1.4</b> Compliance Estimates</a></li>
<li class="chapter" data-level="2.1.5" data-path="data-prep.html"><a href="data-prep.html#data-merger"><i class="fa fa-check"></i><b>2.1.5</b> Data Merger</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-prep.html"><a href="data-prep.html#descriptives"><i class="fa fa-check"></i><b>2.2</b> Descriptives</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-prep.html"><a href="data-prep.html#demographics"><i class="fa fa-check"></i><b>2.2.1</b> Demographics</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-prep.html"><a href="data-prep.html#compliance-rates"><i class="fa fa-check"></i><b>2.2.2</b> Compliance Rates</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-prep.html"><a href="data-prep.html#feature-correlations"><i class="fa fa-check"></i><b>2.2.3</b> Feature Correlations</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-prep.html"><a href="data-prep.html#imputation"><i class="fa fa-check"></i><b>2.3</b> Imputation</a></li>
<li class="chapter" data-level="2.4" data-path="data-prep.html"><a href="data-prep.html#dataset-creation"><i class="fa fa-check"></i><b>2.4</b> Dataset Creation</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data-prep.html"><a href="data-prep.html#weekly-data"><i class="fa fa-check"></i><b>2.4.1</b> Weekly Data</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-prep.html"><a href="data-prep.html#daily-data"><i class="fa fa-check"></i><b>2.4.2</b> Daily Data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-prep.html"><a href="data-prep.html#dataset-export"><i class="fa fa-check"></i><b>2.5</b> Dataset Export</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-testing.html"><a href="model-testing.html"><i class="fa fa-check"></i><b>3</b> Model Testing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="model-testing.html"><a href="model-testing.html#model-predictions"><i class="fa fa-check"></i><b>3.1</b> Model Predictions</a></li>
<li class="chapter" data-level="3.2" data-path="model-testing.html"><a href="model-testing.html#shap-estimate"><i class="fa fa-check"></i><b>3.2</b> SHAP Estimate</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>4</b> Results</a>
<ul>
<li class="chapter" data-level="4.1" data-path="results.html"><a href="results.html#model-performance"><i class="fa fa-check"></i><b>4.1</b> Model Performance</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="results.html"><a href="results.html#training-cv"><i class="fa fa-check"></i><b>4.1.1</b> Training CV</a></li>
<li class="chapter" data-level="4.1.2" data-path="results.html"><a href="results.html#test-data"><i class="fa fa-check"></i><b>4.1.2</b> Test Data</a></li>
<li class="chapter" data-level="4.1.3" data-path="results.html"><a href="results.html#full-results"><i class="fa fa-check"></i><b>4.1.3</b> Full Results</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="results.html"><a href="results.html#idiographic-model-performance"><i class="fa fa-check"></i><b>4.2</b> Idiographic Model Performance</a></li>
<li class="chapter" data-level="4.3" data-path="results.html"><a href="results.html#shap"><i class="fa fa-check"></i><b>4.3</b> SHAP</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="results.html"><a href="results.html#top-10-daily"><i class="fa fa-check"></i><b>4.3.1</b> Top 10 Daily</a></li>
<li class="chapter" data-level="4.3.2" data-path="results.html"><a href="results.html#top-10-weekly"><i class="fa fa-check"></i><b>4.3.2</b> Top 10 Weekly</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="results.html"><a href="results.html#supp-analysis"><i class="fa fa-check"></i><b>4.4</b> Supp Analysis</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="results.html"><a href="results.html#phq-9-autoregressive-model"><i class="fa fa-check"></i><b>4.4.1</b> PHQ-9 Autoregressive Model</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-prep" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Data Prep<a href="data-prep.html#data-prep" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Two data sources are used in the current analysis. <em>Stage 1</em> Qualtrics questionnaires with baseline surveys, <em>Stage 2</em> EMA and Garmin data spanning 85 days. <em>Stage 3</em> Qualtrics questionnaires with follow-up surveys are not used. Data was processed via (WARN-Pipe)[<a href="https://github.com/WARN-D/WARNPipe" class="uri">https://github.com/WARN-D/WARNPipe</a>], a set of functions written to process data acquired in WARN-D. The exact steps implemented to process the data can be found in the scripts directory of the project specific GitHub directory, and a brief summary is provided here.</p>
<ul>
<li>Stage 1 data was analyzed as follows:
<ul>
<li>Variable names were recoded to match the codebook in cases where data exports were inconsistent</li>
<li>NAN correction was applied to instances where -998 and -999 were present, making NANs explicit</li>
<li>Scoring was applied to the different scales in the data</li>
<li>Data was cleaned to remove potential identifiers (I.P. address, emails, etc…)</li>
</ul></li>
<li>Stage 2 data was processed as follows:
<ul>
<li>First, the different ethica exports containing various stages of EMA data were merged</li>
<li>As Ethica stores data with one question per row, we also widen the data to a “regular” long EMA format with one survey per row instead</li>
<li>We finally expand the data to include all potential prompts, as missed prompts were not part of the export</li>
<li>Garmin data was synced to the EMA data in windows of 15, 30, 60, 120, and 240 minutes before each survey. This was done on the ALICE cluster as well.</li>
</ul></li>
</ul>
<p><em>N.B.</em>: File paths are stored as Renviron variables and are not included in the commit.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-prep.html#cb1-1" tabindex="-1"></a><span class="co"># Set dirs for files we need</span></span>
<span id="cb1-2"><a href="data-prep.html#cb1-2" tabindex="-1"></a>df_base <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">here</span>(datasets, <span class="st">&#39;WARND_stage1_c1234_fullset_v2025_10_24.csv&#39;</span>))</span>
<span id="cb1-3"><a href="data-prep.html#cb1-3" tabindex="-1"></a>df_ema <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">here</span>(datasets, <span class="st">&#39;WARND_stage2_c1234_fullset_before_60min_v2025_10_24.csv&#39;</span>))</span></code></pre></div>
<div id="processing" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Processing<a href="data-prep.html#processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that the data is loaded, we can proceed to transform and generate some variables out of the individual items. This is mostly necessary for the EMA data, were we can estimate some features both for the daily variables, and the weekly variables. We first define our variables of interest, and make vectors out of them, and then apply several transformation on them as described in the next sections. We estimate two sets of features: Daily and Weekly.</p>
<ul>
<li>Daily:
<ul>
<li>4x/day:
<ul>
<li>Here we do some simple processing of the data. First we get vectors of all potential features we’re interested in from both the ethica and garmin data. We estimate sleep starts and end times in minutes, and then we fill in categorical items. In cases where they were not endorsed or selected, we get <code>NA</code>s, which is not correct. So we fill in these instances with 0’s</li>
</ul></li>
<li>Morning/Evening (1x/day)
<ul>
<li>We do the same as above for the categorical items</li>
<li>We forward fill the morning items within the same day</li>
<li>We back fill the evening items within the same day</li>
</ul></li>
<li>Evening (1x/day)</li>
</ul></li>
<li>Weekly:
<ul>
<li>We make sum scores for the depression questionnaires</li>
<li>Using the sum scores, we set a cut-off for moderate depression</li>
</ul></li>
</ul>
<div id="daily-features" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Daily Features<a href="data-prep.html#daily-features" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-prep.html#cb2-1" tabindex="-1"></a><span class="co"># Make vectors out of variables we want</span></span>
<span id="cb2-2"><a href="data-prep.html#cb2-2" tabindex="-1"></a>ema_day_vars <span class="ot">=</span> <span class="fu">c</span>( <span class="st">&quot;overwhelm_d&quot;</span>, <span class="st">&quot;motivated_d&quot;</span>, <span class="st">&quot;stressed_d&quot;</span>, <span class="st">&quot;ruminate_d&quot;</span>, <span class="st">&quot;tired_d&quot;</span>, <span class="st">&quot;nervous_d&quot;</span>, <span class="st">&quot;sad_d&quot;</span>, <span class="st">&quot;relaxed_d&quot;</span>, <span class="st">&quot;cheerful_d&quot;</span>, <span class="st">&quot;irritable_d&quot;</span>, <span class="st">&quot;activity_enjoy_d&quot;</span>, <span class="st">&quot;location_d&quot;</span>,<span class="st">&quot;offline_enjoy_d&quot;</span>, <span class="st">&quot;online_enjoy_d&quot;</span>)</span>
<span id="cb2-3"><a href="data-prep.html#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="data-prep.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="data-prep.html#cb2-5" tabindex="-1"></a><span class="co"># Also lets do same for EPA </span></span>
<span id="cb2-6"><a href="data-prep.html#cb2-6" tabindex="-1"></a>epa_day_hr <span class="ot">=</span> <span class="fu">colnames</span>(df_ema <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;hr_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&#39;samp&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_w&quot;</span>)) )</span>
<span id="cb2-7"><a href="data-prep.html#cb2-7" tabindex="-1"></a>epa_day_stress <span class="ot">=</span> <span class="fu">colnames</span>(df_ema <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;stress_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&#39;samp&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_w&quot;</span>)) )</span>
<span id="cb2-8"><a href="data-prep.html#cb2-8" tabindex="-1"></a>epa_day_act <span class="ot">=</span> <span class="fu">colnames</span>(df_ema <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;intraday_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&#39;samp&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_w&quot;</span>)) )</span>
<span id="cb2-9"><a href="data-prep.html#cb2-9" tabindex="-1"></a>epa_day_bat <span class="ot">=</span> <span class="fu">colnames</span>(df_ema <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;body_bat_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&#39;samp&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_w&quot;</span>)) )</span>
<span id="cb2-10"><a href="data-prep.html#cb2-10" tabindex="-1"></a>epa_sleep <span class="ot">=</span> <span class="fu">colnames</span>(df_ema <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sleep_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&#39;samp&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_m&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;sleep_hr&quot;</span>)) )</span>
<span id="cb2-11"><a href="data-prep.html#cb2-11" tabindex="-1"></a>epa_sleep_hr <span class="ot">=</span> <span class="fu">colnames</span>(df_ema <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sleep_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&#39;samp&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_m&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sleep_hr&quot;</span>)) )</span>
<span id="cb2-12"><a href="data-prep.html#cb2-12" tabindex="-1"></a>epa_day_summary <span class="ot">=</span> <span class="fu">colnames</span>(df_ema <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;day_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&#39;samp&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_num&quot;</span>)) )</span>
<span id="cb2-13"><a href="data-prep.html#cb2-13" tabindex="-1"></a><span class="co"># put them all togethet</span></span>
<span id="cb2-14"><a href="data-prep.html#cb2-14" tabindex="-1"></a>epa_day_vars <span class="ot">=</span> <span class="fu">c</span>(epa_day_hr, epa_day_stress, epa_day_act[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>)], epa_day_bat)</span>
<span id="cb2-15"><a href="data-prep.html#cb2-15" tabindex="-1"></a>epa_sleep_vars <span class="ot">=</span> <span class="fu">c</span>(epa_sleep_hr, <span class="st">&#39;sleep_start&#39;</span>, <span class="st">&#39;sleep_end&#39;</span>, <span class="st">&#39;sleep_dur_tot_s&#39;</span>)</span>
<span id="cb2-16"><a href="data-prep.html#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="data-prep.html#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="data-prep.html#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="data-prep.html#cb2-19" tabindex="-1"></a><span class="co"># Convert sleep start and end times to minutes from midnight</span></span>
<span id="cb2-20"><a href="data-prep.html#cb2-20" tabindex="-1"></a>df_ema <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span></span>
<span id="cb2-21"><a href="data-prep.html#cb2-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>( <span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&#39;sleep_start&#39;</span>, <span class="st">&#39;sleep_end&#39;</span>)), <span class="sc">~</span> {</span>
<span id="cb2-22"><a href="data-prep.html#cb2-22" tabindex="-1"></a>    hour_part <span class="ot">&lt;-</span> <span class="fu">hour</span>(.x)</span>
<span id="cb2-23"><a href="data-prep.html#cb2-23" tabindex="-1"></a>    minute_part <span class="ot">&lt;-</span> <span class="fu">minute</span>(.x)</span>
<span id="cb2-24"><a href="data-prep.html#cb2-24" tabindex="-1"></a>    minutes_from_midnight <span class="ot">&lt;-</span> hour_part <span class="sc">*</span> <span class="dv">60</span> <span class="sc">+</span> minute_part</span>
<span id="cb2-25"><a href="data-prep.html#cb2-25" tabindex="-1"></a>    minutes_from_midnight}, <span class="at">.names =</span> <span class="st">&quot;{.col}&quot;</span> ) )</span>
<span id="cb2-26"><a href="data-prep.html#cb2-26" tabindex="-1"></a>  </span>
<span id="cb2-27"><a href="data-prep.html#cb2-27" tabindex="-1"></a><span class="co"># Now fix the daily category items</span></span>
<span id="cb2-28"><a href="data-prep.html#cb2-28" tabindex="-1"></a><span class="do">## First select the coloumns</span></span>
<span id="cb2-29"><a href="data-prep.html#cb2-29" tabindex="-1"></a>activity_cat_d <span class="ot">=</span>  <span class="fu">colnames</span>(df_ema)[<span class="fu">grep</span>(<span class="st">&#39;^activity_cat_d&#39;</span>, <span class="fu">colnames</span>(df_ema))]</span>
<span id="cb2-30"><a href="data-prep.html#cb2-30" tabindex="-1"></a>online_cat_d <span class="ot">=</span> <span class="fu">colnames</span>(df_ema)[<span class="fu">grep</span>(<span class="st">&#39;^online_cat_d&#39;</span>, <span class="fu">colnames</span>(df_ema))]</span>
<span id="cb2-31"><a href="data-prep.html#cb2-31" tabindex="-1"></a>offline_cat_d <span class="ot">=</span> <span class="fu">colnames</span>(df_ema)[<span class="fu">grep</span>(<span class="st">&#39;^offline_cat_d&#39;</span>, <span class="fu">colnames</span>(df_ema))]</span>
<span id="cb2-32"><a href="data-prep.html#cb2-32" tabindex="-1"></a></span>
<span id="cb2-33"><a href="data-prep.html#cb2-33" tabindex="-1"></a>categorical_items_d <span class="ot">=</span> <span class="fu">c</span>(activity_cat_d, offline_cat_d, online_cat_d)</span>
<span id="cb2-34"><a href="data-prep.html#cb2-34" tabindex="-1"></a></span>
<span id="cb2-35"><a href="data-prep.html#cb2-35" tabindex="-1"></a>df_ema <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span> </span>
<span id="cb2-36"><a href="data-prep.html#cb2-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(categorical_items_d), <span class="sc">~</span> <span class="fu">if_else</span>(.x <span class="sc">&gt;</span><span class="dv">0</span>, <span class="dv">1</span>, .x)), <span class="co"># First turn into binary items for categories</span></span>
<span id="cb2-37"><a href="data-prep.html#cb2-37" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">all_of</span>(categorical_items_d), <span class="sc">~</span> <span class="fu">if_else</span>( (<span class="fu">is.na</span>(.x) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(activity_enjoy_d)), <span class="dv">0</span>, .x)) )<span class="co"># Now replace the unselected MCQ options with 0</span></span></code></pre></div>
</div>
<div id="morningevening-features" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Morning/Evening Features<a href="data-prep.html#morningevening-features" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-prep.html#cb3-1" tabindex="-1"></a>ema_mor_vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;sleep_qual_m&#39;</span>,<span class="st">&#39;sleep_rest_m&#39;</span>,<span class="st">&#39;outlook_m&#39;</span>)</span>
<span id="cb3-2"><a href="data-prep.html#cb3-2" tabindex="-1"></a>pos_exp_cats <span class="ot">=</span> <span class="fu">colnames</span>(df_ema)[<span class="fu">grep</span>(<span class="st">&#39;^pos_exp_cat_e&#39;</span>, <span class="fu">colnames</span>(df_ema))]</span>
<span id="cb3-3"><a href="data-prep.html#cb3-3" tabindex="-1"></a>neg_exp_cats <span class="ot">=</span> <span class="fu">colnames</span>(df_ema)[<span class="fu">grep</span>(<span class="st">&#39;^neg_exp_cat_e&#39;</span>, <span class="fu">colnames</span>(df_ema))]</span>
<span id="cb3-4"><a href="data-prep.html#cb3-4" tabindex="-1"></a>substance_cats <span class="ot">=</span> <span class="fu">colnames</span>(df_ema)[<span class="fu">grep</span>(<span class="st">&#39;^substance_e&#39;</span>, <span class="fu">colnames</span>(df_ema))]</span>
<span id="cb3-5"><a href="data-prep.html#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="data-prep.html#cb3-6" tabindex="-1"></a>ema_eve_vars <span class="ot">=</span> <span class="fu">c</span>( <span class="st">&#39;discomfort_e&#39;</span>, <span class="st">&#39;emo_reg_e&#39;</span>, <span class="st">&#39;useful_e&#39;</span>, <span class="st">&#39;neg_exp_e&#39;</span>, <span class="st">&#39;pos_exp_e&#39;</span>,  pos_exp_cats, neg_exp_cats, substance_cats)</span>
<span id="cb3-7"><a href="data-prep.html#cb3-7" tabindex="-1"></a>ema_eve_vars <span class="ot">=</span> ema_eve_vars[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;_NA&quot;</span>, ema_eve_vars)]</span>
<span id="cb3-8"><a href="data-prep.html#cb3-8" tabindex="-1"></a>df_ema <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="data-prep.html#cb3-9" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id, date) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="data-prep.html#cb3-10" tabindex="-1"></a>  <span class="co"># Here we check for the MC questions, if an evening is anwered by cat is NA, replace with 0</span></span>
<span id="cb3-11"><a href="data-prep.html#cb3-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(pos_exp_cats, neg_exp_cats, substance_cats)), <span class="sc">~</span> <span class="fu">if_else</span>( (<span class="fu">is.na</span>(.x) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(emo_reg_e)), <span class="dv">0</span>, .x))) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="data-prep.html#cb3-12" tabindex="-1"></a>  <span class="fu">fill</span>(<span class="fu">all_of</span>(ema_mor_vars), <span class="at">.direction =</span> <span class="st">&#39;down&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="data-prep.html#cb3-13" tabindex="-1"></a>  <span class="fu">fill</span>(<span class="fu">all_of</span>(ema_eve_vars), <span class="at">.direction =</span> <span class="st">&#39;up&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-14"><a href="data-prep.html#cb3-14" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="data-prep.html#cb3-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(neg_exp_cats, pos_exp_cats, substance_cats)), <span class="sc">~</span> <span class="fu">if_else</span>(.x<span class="sc">&gt;</span><span class="dv">0</span>, <span class="dv">1</span>, .x)))</span></code></pre></div>
</div>
<div id="weekly-features" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Weekly Features<a href="data-prep.html#weekly-features" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-prep.html#cb4-1" tabindex="-1"></a><span class="co"># First make the grouping factor</span></span>
<span id="cb4-2"><a href="data-prep.html#cb4-2" tabindex="-1"></a>df_ema<span class="sc">$</span>week_n <span class="ot">=</span> <span class="fu">isoweek</span>(df_ema<span class="sc">$</span>date)</span>
<span id="cb4-3"><a href="data-prep.html#cb4-3" tabindex="-1"></a><span class="co"># create a list of PHQ items</span></span>
<span id="cb4-4"><a href="data-prep.html#cb4-4" tabindex="-1"></a>phq_items_w <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;phq5_appet_loss_w&quot;</span>, <span class="st">&quot;phq7_concentr_w&quot;</span> , <span class="st">&quot;phq5_overeat_w&quot;</span>, <span class="st">&quot;phq8_retar_w&quot;</span>, <span class="st">&quot;phq9_suicide_w&quot;</span>, <span class="st">&quot;phq12_libido_w&quot;</span>, </span>
<span id="cb4-5"><a href="data-prep.html#cb4-5" tabindex="-1"></a>  <span class="st">&quot;phq6_worthless_w&quot;</span> , <span class="st">&quot;phq11_irrit_w&quot;</span>, <span class="st">&quot;phq2_sad_w&quot;</span> , <span class="st">&quot;phq8_agitate_w&quot;</span>, <span class="st">&quot;phq2_hopeless_w&quot;</span>, <span class="st">&quot;phq1_anhedo_w&quot;</span> , </span>
<span id="cb4-6"><a href="data-prep.html#cb4-6" tabindex="-1"></a>  <span class="st">&quot;phq3_insomnia_w&quot;</span>, <span class="st">&quot;phq3_hypersom_w&quot;</span> , <span class="st">&quot;phq4_tired_w&quot;</span>)  </span>
<span id="cb4-7"><a href="data-prep.html#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="data-prep.html#cb4-8" tabindex="-1"></a><span class="co"># First we estimate the evening depression</span></span>
<span id="cb4-9"><a href="data-prep.html#cb4-9" tabindex="-1"></a>df_ema <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="data-prep.html#cb4-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phq2_sum_e =</span> anhedonia_e <span class="sc">+</span> depressed_e)</span>
<span id="cb4-11"><a href="data-prep.html#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="data-prep.html#cb4-12" tabindex="-1"></a><span class="co"># estimate PHQ9 Sum score for weekly too</span></span>
<span id="cb4-13"><a href="data-prep.html#cb4-13" tabindex="-1"></a>df_ema <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="data-prep.html#cb4-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">phq9_sum_w =</span> pseudo_phq9_sum_w) <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="data-prep.html#cb4-15" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-16"><a href="data-prep.html#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="data-prep.html#cb4-17" tabindex="-1"></a><span class="co"># Create a week variable for grouping</span></span>
<span id="cb4-18"><a href="data-prep.html#cb4-18" tabindex="-1"></a>df_ema <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span> </span>
<span id="cb4-19"><a href="data-prep.html#cb4-19" tabindex="-1"></a>  <span class="co"># Estimate the week number and weekly days</span></span>
<span id="cb4-20"><a href="data-prep.html#cb4-20" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-21"><a href="data-prep.html#cb4-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week_nr =</span> <span class="fu">floor</span>(<span class="fu">as.numeric</span>(<span class="fu">difftime</span>(date, <span class="fu">min</span>(date, <span class="at">na.rm =</span> T), <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>))) ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-22"><a href="data-prep.html#cb4-22" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id, week_nr) <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="data-prep.html#cb4-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_nr =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(date, <span class="fu">min</span>(date, <span class="at">na.rm =</span> T), <span class="at">units =</span> <span class="st">&quot;days&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-24"><a href="data-prep.html#cb4-24" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-25"><a href="data-prep.html#cb4-25" tabindex="-1"></a></span>
<span id="cb4-26"><a href="data-prep.html#cb4-26" tabindex="-1"></a><span class="co"># Now estimate the daily and weekly depression</span></span>
<span id="cb4-27"><a href="data-prep.html#cb4-27" tabindex="-1"></a>df_ema <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span> </span>
<span id="cb4-28"><a href="data-prep.html#cb4-28" tabindex="-1"></a>  <span class="co"># Estimate the centered valyes for the phq9</span></span>
<span id="cb4-29"><a href="data-prep.html#cb4-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(external_id) <span class="sc">%&gt;%</span></span>
<span id="cb4-30"><a href="data-prep.html#cb4-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(phq_items_w, <span class="st">&#39;phq9_sum_w&#39;</span>)), <span class="sc">~</span> (.x <span class="sc">-</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span>T)),<span class="at">.names =</span>  <span class="st">&quot;{.col}_c&quot;</span> )) <span class="sc">%&gt;%</span> </span>
<span id="cb4-31"><a href="data-prep.html#cb4-31" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb4-32"><a href="data-prep.html#cb4-32" tabindex="-1"></a>  <span class="co"># Fill backwards daily</span></span>
<span id="cb4-33"><a href="data-prep.html#cb4-33" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id, day_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb4-34"><a href="data-prep.html#cb4-34" tabindex="-1"></a>  <span class="fu">fill</span>(phq2_sum_e, <span class="at">.direction =</span> <span class="st">&#39;up&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-35"><a href="data-prep.html#cb4-35" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-36"><a href="data-prep.html#cb4-36" tabindex="-1"></a>  <span class="co"># Fill backwards weekly</span></span>
<span id="cb4-37"><a href="data-prep.html#cb4-37" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id, week_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb4-38"><a href="data-prep.html#cb4-38" tabindex="-1"></a>  <span class="fu">fill</span>(phq9_sum_w, <span class="at">.direction =</span> <span class="st">&#39;updown&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-39"><a href="data-prep.html#cb4-39" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-40"><a href="data-prep.html#cb4-40" tabindex="-1"></a></span>
<span id="cb4-41"><a href="data-prep.html#cb4-41" tabindex="-1"></a></span>
<span id="cb4-42"><a href="data-prep.html#cb4-42" tabindex="-1"></a><span class="co"># Estimate the cutoff for PHQ 9</span></span>
<span id="cb4-43"><a href="data-prep.html#cb4-43" tabindex="-1"></a>df_ema<span class="sc">$</span>phq9_cuttoff <span class="ot">=</span> <span class="fu">ifelse</span>(df_ema<span class="sc">$</span>phq9_sum_w <span class="sc">&gt;</span> <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="compliance-estimates" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Compliance Estimates<a href="data-prep.html#compliance-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we make some compliance estimates for the data. We do this for the EMA and garmin data separately.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-prep.html#cb5-1" tabindex="-1"></a><span class="co"># Add comploance rates (without prompt_5)</span></span>
<span id="cb5-2"><a href="data-prep.html#cb5-2" tabindex="-1"></a>df_ema_compliance <span class="ot">=</span> df_ema <span class="sc">%&gt;%</span> <span class="fu">filter</span>(prompt_num <span class="sc">!=</span> <span class="dv">5</span>)</span>
<span id="cb5-3"><a href="data-prep.html#cb5-3" tabindex="-1"></a>df_ema_compliance<span class="sc">$</span>compliance <span class="ot">=</span> esmpack<span class="sc">::</span><span class="fu">calc.nomiss</span>(sad_d, <span class="at">id =</span> external_id, <span class="at">data =</span> df_ema_compliance, <span class="at">prop =</span> T, <span class="at">expand =</span> T)</span>
<span id="cb5-4"><a href="data-prep.html#cb5-4" tabindex="-1"></a>df_ema_compliance<span class="sc">$</span>compliance_hr <span class="ot">=</span> esmpack<span class="sc">::</span><span class="fu">calc.nomiss</span>(hr_mean, <span class="at">id =</span> external_id, <span class="at">data =</span> df_ema_compliance, <span class="at">prop =</span> T, <span class="at">expand =</span> T)</span>
<span id="cb5-5"><a href="data-prep.html#cb5-5" tabindex="-1"></a>df_ema_compliance<span class="sc">$</span>compliance_stress <span class="ot">=</span> esmpack<span class="sc">::</span><span class="fu">calc.nomiss</span>(stress_mean, <span class="at">id =</span> external_id, <span class="at">data =</span> df_ema_compliance, <span class="at">prop =</span> T, <span class="at">expand =</span> T)</span>
<span id="cb5-6"><a href="data-prep.html#cb5-6" tabindex="-1"></a>df_ema_compliance <span class="ot">=</span> df_ema_compliance <span class="sc">%&gt;%</span> <span class="fu">select</span>(external_id, <span class="fu">starts_with</span>(<span class="st">&quot;compliance&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb5-7"><a href="data-prep.html#cb5-7" tabindex="-1"></a><span class="co"># Add compliance rates to main df</span></span>
<span id="cb5-8"><a href="data-prep.html#cb5-8" tabindex="-1"></a>df_ema <span class="ot">=</span> <span class="fu">merge</span>(df_ema, df_ema_compliance, <span class="at">by =</span> <span class="st">&#39;external_id&#39;</span>, <span class="at">all =</span> T)</span></code></pre></div>
</div>
<div id="data-merger" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Data Merger<a href="data-prep.html#data-merger" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the preprocessing is done, we attach the EMA data to the baseline data so that we can get per-subject values for our descriptives.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-prep.html#cb6-1" tabindex="-1"></a><span class="co"># Merge base to ema</span></span>
<span id="cb6-2"><a href="data-prep.html#cb6-2" tabindex="-1"></a>df_merge <span class="ot">=</span> <span class="fu">merge</span>(df_base, df_ema, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;external_id&#39;</span>, <span class="st">&#39;cohort&#39;</span>), <span class="at">all =</span> T)</span>
<span id="cb6-3"><a href="data-prep.html#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="data-prep.html#cb6-4" tabindex="-1"></a><span class="co"># Filter based on compliance</span></span>
<span id="cb6-5"><a href="data-prep.html#cb6-5" tabindex="-1"></a>df_merge <span class="ot">=</span> df_merge[df_merge<span class="sc">$</span>compliance <span class="sc">&gt;</span> <span class="fl">0.3</span>, ]</span>
<span id="cb6-6"><a href="data-prep.html#cb6-6" tabindex="-1"></a>df_merge <span class="ot">=</span> df_merge[<span class="sc">!</span><span class="fu">is.na</span>(df_merge<span class="sc">$</span>cohort), ]</span>
<span id="cb6-7"><a href="data-prep.html#cb6-7" tabindex="-1"></a>df_merge <span class="ot">=</span> df_merge[<span class="sc">!</span><span class="fu">is.na</span>(df_merge<span class="sc">$</span>prompt_num), ]</span>
<span id="cb6-8"><a href="data-prep.html#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="data-prep.html#cb6-9" tabindex="-1"></a><span class="co"># read training list and filter subjects</span></span>
<span id="cb6-10"><a href="data-prep.html#cb6-10" tabindex="-1"></a>training_set <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(project_folder, <span class="st">&#39;data&#39;</span>, <span class="st">&#39;participants&#39;</span>, <span class="st">&#39;linked_ids_training_set_seed666_by_Cohort.csv&#39;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="descriptives" class="section level2 tabset hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Descriptives<a href="data-prep.html#descriptives" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lets take a look at some general data exploration and descriptives here. I specifically want to look at demopgraphics and EMA compliance rates. I’ll also take a look at the general distributions and trends in the data. We check the correlations between our different features. We use the baseline PHQ, Garmin, and EMA variables. We first check the overall correlations, and then check the ones with r &gt; 0.7 for feature selection. This helps us make our models a bit more parsimonious. Based on these matrices, we see that HR mean is highly correlated with the mean, and minimum of the stress measure, mean of the body battery is also highly correlated with the mean and minimum.</p>
<div id="demographics" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Demographics<a href="data-prep.html#demographics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-prep.html#cb7-1" tabindex="-1"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb7-2"><a href="data-prep.html#cb7-2" tabindex="-1"></a>df_descriptive <span class="ot">=</span> <span class="fu">merge</span>(training_set, df_merge, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;external_id&quot;</span>, <span class="st">&quot;cohort&quot;</span>), <span class="at">all.y =</span> T)</span>
<span id="cb7-3"><a href="data-prep.html#cb7-3" tabindex="-1"></a>df_descriptive <span class="ot">&lt;-</span>  df_descriptive<span class="sc">%&gt;%</span>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="data-prep.html#cb7-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sum_lidas =</span> <span class="fu">sum</span>(core1_lidas, core2_lidas, core3_lidas, lidas_13,appetite_lidas,</span>
<span id="cb7-5"><a href="data-prep.html#cb7-5" tabindex="-1"></a>                                  sleep_lidas,motor_lidas,concentr_lidas,lidas_27,lidas_28, </span>
<span id="cb7-6"><a href="data-prep.html#cb7-6" tabindex="-1"></a>                                  <span class="at">na.rm=</span>T),</span>
<span id="cb7-7"><a href="data-prep.html#cb7-7" tabindex="-1"></a>                  <span class="at">lidas_cut_off =</span> <span class="fu">ifelse</span>( ((core1_lidas<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> core2_lidas <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> core3_lidas <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;</span>  sum_lidas<span class="sc">&gt;=</span><span class="dv">5</span> <span class="sc">&amp;</span> lidas_29<span class="sc">==</span><span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-8"><a href="data-prep.html#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="data-prep.html#cb7-9" tabindex="-1"></a>df_desc_summ <span class="ot">=</span> df_descriptive <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="data-prep.html#cb7-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">training_set =</span> <span class="fu">if_else</span>(training_set <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&#39;train&#39;</span>, <span class="st">&#39;test&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="data-prep.html#cb7-11" tabindex="-1"></a>  <span class="fu">group_by</span>(training_set) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="data-prep.html#cb7-12" tabindex="-1"></a>  <span class="fu">distinct</span>(external_id, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="data-prep.html#cb7-13" tabindex="-1"></a>  <span class="fu">select</span>(age, sex, lvl_edu, nationality, sss, pseudo_phq9_sum, lidas_cut_off) <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="data-prep.html#cb7-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;lvl_edu&quot;</span>, <span class="st">&quot;nationality&quot;</span>, <span class="st">&quot;lidas_cut_off&quot;</span>), <span class="sc">~</span> <span class="fu">factor</span>(.x)))</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `training_set`</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-prep.html#cb9-1" tabindex="-1"></a><span class="fu">dfSummary</span>(df_desc_summ, <span class="at">plain.ascii =</span> T, <span class="at">graph.col =</span> F)</span></code></pre></div>
<pre><code>## Data Frame Summary  
## df_desc_summ  
## Group: training_set = train  
## Dimensions: 855 x 8  
## Duplicates: 57  
## 
## -----------------------------------------------------------------------------------------
## No   Variable          Stats / Values           Freqs (% of Valid)   Valid      Missing  
## ---- ----------------- ------------------------ -------------------- ---------- ---------
## 2    age               Mean (sd) : 22.7 (4.1)   28 distinct values   854        1        
##      [integer]         min &lt; med &lt; max:                              (99.9%)    (0.1%)   
##                        18 &lt; 22 &lt; 61                                                      
##                        IQR (CV) : 4 (0.2)                                                
## 
## 3    sex               1. 0                     124 (14.5%)          854        1        
##      [factor]          2. 1                     730 (85.5%)          (99.9%)    (0.1%)   
## 
## 4    lvl_edu           1. 3                     418 (49.3%)          848        7        
##      [factor]          2. 4                      35 ( 4.1%)          (99.2%)    (0.8%)   
##                        3. 5                      47 ( 5.5%)                              
##                        4. 6                       3 ( 0.4%)                              
##                        5. 7                     277 (32.7%)                              
##                        6. 8                      66 ( 7.8%)                              
##                        7. 9                       2 ( 0.2%)                              
## 
## 5    nationality       1. 1                     453 (53.0%)          854        1        
##      [factor]          2. 2                     338 (39.6%)          (99.9%)    (0.1%)   
##                        3. 3                      63 ( 7.4%)                              
## 
## 6    sss               Mean (sd) : 7 (1.4)      1 :   1 ( 0.1%)      854        1        
##      [integer]         min &lt; med &lt; max:         2 :   2 ( 0.2%)      (99.9%)    (0.1%)   
##                        1 &lt; 7 &lt; 10               3 :   9 ( 1.1%)                          
##                        IQR (CV) : 2 (0.2)       4 :  40 ( 4.7%)                          
##                                                 5 :  65 ( 7.6%)                          
##                                                 6 : 135 (15.8%)                          
##                                                 7 : 292 (34.2%)                          
##                                                 8 : 225 (26.3%)                          
##                                                 9 :  73 ( 8.5%)                          
##                                                 10 :  12 ( 1.4%)                         
## 
## 7    pseudo_phq9_sum   Mean (sd) : 7.2 (4.5)    25 distinct values   854        1        
##      [integer]         min &lt; med &lt; max:                              (99.9%)    (0.1%)   
##                        0 &lt; 7 &lt; 25                                                        
##                        IQR (CV) : 6 (0.6)                                                
## 
## 8    lidas_cut_off     1. 0                     495 (57.9%)          855        0        
##      [factor]          2. 1                     360 (42.1%)          (100.0%)   (0.0%)   
## -----------------------------------------------------------------------------------------
## 
## Group: training_set = NA  
## Dimensions: 358 x 8  
## Duplicates: 9  
## 
## -----------------------------------------------------------------------------------------
## No   Variable          Stats / Values           Freqs (% of Valid)   Valid      Missing  
## ---- ----------------- ------------------------ -------------------- ---------- ---------
## 2    age               Mean (sd) : 22.4 (3.4)   20 distinct values   358        0        
##      [integer]         min &lt; med &lt; max:                              (100.0%)   (0.0%)   
##                        18 &lt; 22 &lt; 42                                                      
##                        IQR (CV) : 4 (0.2)                                                
## 
## 3    sex               1. 0                      58 (16.2%)          358        0        
##      [factor]          2. 1                     300 (83.8%)          (100.0%)   (0.0%)   
## 
## 4    lvl_edu           1. 3                     165 (46.6%)          354        4        
##      [factor]          2. 4                      14 ( 4.0%)          (98.9%)    (1.1%)   
##                        3. 5                      21 ( 5.9%)                              
##                        4. 6                       1 ( 0.3%)                              
##                        5. 7                     128 (36.2%)                              
##                        6. 8                      24 ( 6.8%)                              
##                        7. 9                       1 ( 0.3%)                              
## 
## 5    nationality       1. 1                     184 (51.4%)          358        0        
##      [factor]          2. 2                     137 (38.3%)          (100.0%)   (0.0%)   
##                        3. 3                      37 (10.3%)                              
## 
## 6    sss               Mean (sd) : 6.8 (1.4)    2 :   1 ( 0.3%)      358        0        
##      [integer]         min &lt; med &lt; max:         3 :   6 ( 1.7%)      (100.0%)   (0.0%)   
##                        2 &lt; 7 &lt; 10               4 :  18 ( 5.0%)                          
##                        IQR (CV) : 2 (0.2)       5 :  32 ( 8.9%)                          
##                                                 6 :  57 (15.9%)                          
##                                                 7 : 127 (35.5%)                          
##                                                 8 :  92 (25.7%)                          
##                                                 9 :  21 ( 5.9%)                          
##                                                 10 :   4 ( 1.1%)                         
## 
## 7    pseudo_phq9_sum   Mean (sd) : 7.5 (4.7)    21 distinct values   358        0        
##      [integer]         min &lt; med &lt; max:                              (100.0%)   (0.0%)   
##                        0 &lt; 7 &lt; 22                                                        
##                        IQR (CV) : 7 (0.6)                                                
## 
## 8    lidas_cut_off     1. 0                     211 (58.9%)          358        0        
##      [factor]          2. 1                     147 (41.1%)          (100.0%)   (0.0%)   
## -----------------------------------------------------------------------------------------</code></pre>
</div>
<div id="compliance-rates" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Compliance Rates<a href="data-prep.html#compliance-rates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here are the compliance rates</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-prep.html#cb11-1" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;EMA Compliance&quot;</span>)</span></code></pre></div>
<pre><code>## EMA Compliance</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-prep.html#cb13-1" tabindex="-1"></a>(<span class="fu">summary</span>(df_ema_compliance<span class="sc">$</span>compliance, <span class="at">title=</span><span class="st">&quot;EMA&quot;</span>))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.2703  0.5382  0.5097  0.7500  0.9941</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-prep.html#cb15-1" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Garmin Compliance&quot;</span>)</span></code></pre></div>
<pre><code>## Garmin Compliance</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-prep.html#cb17-1" tabindex="-1"></a><span class="fu">summary</span>(df_ema_compliance<span class="sc">$</span>compliance_hr)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.4647  0.8235  0.6704  0.9265  1.0000</code></pre>
<p>And now plots for the distribution of the compliance rates:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-prep.html#cb19-1" tabindex="-1"></a>df_merge<span class="sc">$</span>cohort <span class="ot">=</span> <span class="fu">as.factor</span>(df_merge<span class="sc">$</span>cohort)</span>
<span id="cb19-2"><a href="data-prep.html#cb19-2" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(</span>
<span id="cb19-3"><a href="data-prep.html#cb19-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_merge, <span class="fu">aes</span>(<span class="at">x=</span>compliance, <span class="at">fill =</span> cohort)) <span class="sc">+</span> </span>
<span id="cb19-4"><a href="data-prep.html#cb19-4" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Compliance-EMA&quot;</span>) <span class="sc">+</span> </span>
<span id="cb19-5"><a href="data-prep.html#cb19-5" tabindex="-1"></a>    <span class="fu">facet_grid</span>(.<span class="sc">~</span>cohort), </span>
<span id="cb19-6"><a href="data-prep.html#cb19-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_merge, <span class="fu">aes</span>(<span class="at">x=</span>compliance_hr, <span class="at">fill =</span> cohort)) <span class="sc">+</span></span>
<span id="cb19-7"><a href="data-prep.html#cb19-7" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Compliance-HR&quot;</span>) <span class="sc">+</span> </span>
<span id="cb19-8"><a href="data-prep.html#cb19-8" tabindex="-1"></a>    <span class="fu">facet_grid</span>(.<span class="sc">~</span>cohort),</span>
<span id="cb19-9"><a href="data-prep.html#cb19-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_merge, <span class="fu">aes</span>(<span class="at">x=</span>compliance_stress, <span class="at">fill =</span> cohort)) <span class="sc">+</span></span>
<span id="cb19-10"><a href="data-prep.html#cb19-10" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">50</span>) <span class="sc">+</span> </span>
<span id="cb19-11"><a href="data-prep.html#cb19-11" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Compliance-Stress&quot;</span>) <span class="sc">+</span> </span>
<span id="cb19-12"><a href="data-prep.html#cb19-12" tabindex="-1"></a>    <span class="fu">facet_grid</span>(.<span class="sc">~</span>cohort),</span>
<span id="cb19-13"><a href="data-prep.html#cb19-13" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="final_report_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="feature-correlations" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Feature Correlations<a href="data-prep.html#feature-correlations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We take a look at the correlation of features, and then also check which are the features with super high correlations.</p>
<div id="full-features" class="section level4 hasAnchor" number="2.2.3.1">
<h4><span class="header-section-number">2.2.3.1</span> Full Features<a href="data-prep.html#full-features" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-prep.html#cb20-1" tabindex="-1"></a>df_merge_corr <span class="ot">=</span> df_merge <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="data-prep.html#cb20-2" tabindex="-1"></a>  <span class="fu">select</span>(external_id, day_num, prompt_num, pseudo_phq9_sum, phq2_sum_e, phq9_sum_w, <span class="fu">all_of</span>(ema_day_vars), <span class="fu">all_of</span>(epa_day_vars),<span class="fu">starts_with</span>(<span class="st">&quot;sleep_dur&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&#39;sleep_hr&#39;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="data-prep.html#cb20-3" tabindex="-1"></a>  <span class="fu">arrange</span>(external_id, day_num, prompt_num)</span>
<span id="cb20-4"><a href="data-prep.html#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="data-prep.html#cb20-5" tabindex="-1"></a>corr_all <span class="ot">=</span> <span class="fu">correlate</span>(df_merge_corr, <span class="at">diagonal =</span> T, <span class="at">method =</span> <span class="st">&#39;spearman&#39;</span> )</span></code></pre></div>
<pre><code>## Non-numeric variables removed from input: `external_id`
## Correlation computed with
## • Method: &#39;spearman&#39;
## • Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-prep.html#cb22-1" tabindex="-1"></a>corr_all_plot <span class="ot">=</span> <span class="fu">corrplot</span>(<span class="fu">as_matrix</span>(corr_all), <span class="at">type =</span>  <span class="st">&#39;lower&#39;</span>,<span class="at">method =</span> <span class="st">&#39;color&#39;</span>, <span class="at">addgrid.col =</span> <span class="st">&#39;aliceblue&#39;</span>, <span class="at">tl.cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="final_report_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="highly-correlated-features" class="section level4 hasAnchor" number="2.2.3.2">
<h4><span class="header-section-number">2.2.3.2</span> Highly Correlated Features<a href="data-prep.html#highly-correlated-features" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-prep.html#cb23-1" tabindex="-1"></a>corr_high <span class="ot">=</span> <span class="fu">correlate</span>(df_merge_corr, <span class="at">diagonal =</span> T)</span></code></pre></div>
<pre><code>## Non-numeric variables removed from input: `external_id`
## Correlation computed with
## • Method: &#39;pearson&#39;
## • Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-prep.html#cb25-1" tabindex="-1"></a>corr_high <span class="ot">=</span> corr_high <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>((.x <span class="sc">&lt;=</span> <span class="fl">0.7</span> <span class="sc">&amp;</span> .x <span class="sc">&gt;=</span> <span class="sc">-</span><span class="fl">0.7</span>), <span class="dv">0</span>, .x)))</span>
<span id="cb25-2"><a href="data-prep.html#cb25-2" tabindex="-1"></a><span class="fu">corrplot</span>(<span class="fu">as_matrix</span>(corr_high), <span class="at">type =</span>  <span class="st">&#39;lower&#39;</span>, <span class="at">method =</span> <span class="st">&#39;color&#39;</span>, <span class="at">addgrid.col =</span> <span class="st">&#39;aliceblue&#39;</span>, <span class="at">tl.cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="final_report_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="imputation" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Imputation<a href="data-prep.html#imputation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here I use MICE for imputation, setting my imputation model to a random forest model at the within-subject levels. We include in this model all predictors, and we set outcomes and ID to 0 so we can exclude them from any predictions. We then check if any variables have a constant value. This occurs for example in some of the substance use items, or perhaps location items. So we fill those with the constant value the participants endorsed (or didn’t). Once that’s done, we exclude those predictors from our matrix as well, and then implement MICE.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-prep.html#cb26-1" tabindex="-1"></a><span class="co"># Select non-composite EMA variable</span></span>
<span id="cb26-2"><a href="data-prep.html#cb26-2" tabindex="-1"></a>ema_vars <span class="ot">=</span> <span class="fu">c</span>(ema_mor_vars, ema_day_vars, ema_eve_vars, categorical_items_d)</span>
<span id="cb26-3"><a href="data-prep.html#cb26-3" tabindex="-1"></a><span class="co"># Now also select som EPA variables (subset sleep)</span></span>
<span id="cb26-4"><a href="data-prep.html#cb26-4" tabindex="-1"></a>epa_vars <span class="ot">=</span> <span class="fu">c</span>(epa_day_hr, epa_day_stress, epa_sleep_vars, epa_day_act[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>)], epa_day_bat)</span>
<span id="cb26-5"><a href="data-prep.html#cb26-5" tabindex="-1"></a><span class="co"># Vector of IVs of interest and n of features</span></span>
<span id="cb26-6"><a href="data-prep.html#cb26-6" tabindex="-1"></a>impute_vars <span class="ot">=</span>  <span class="fu">c</span>(ema_vars, epa_vars)</span>
<span id="cb26-7"><a href="data-prep.html#cb26-7" tabindex="-1"></a></span>
<span id="cb26-8"><a href="data-prep.html#cb26-8" tabindex="-1"></a><span class="co"># Subset data</span></span>
<span id="cb26-9"><a href="data-prep.html#cb26-9" tabindex="-1"></a>df_features <span class="ot">=</span> df_merge <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="data-prep.html#cb26-10" tabindex="-1"></a>  <span class="fu">select</span>(external_id, week_nr, day_nr, prompt_num,</span>
<span id="cb26-11"><a href="data-prep.html#cb26-11" tabindex="-1"></a>         phq9_sum_w, phq2_sum_e, <span class="fu">all_of</span>(impute_vars) )  <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="data-prep.html#cb26-12" tabindex="-1"></a>  <span class="fu">filter</span>(prompt_num <span class="sc">!=</span> <span class="dv">5</span>) </span>
<span id="cb26-13"><a href="data-prep.html#cb26-13" tabindex="-1"></a></span>
<span id="cb26-14"><a href="data-prep.html#cb26-14" tabindex="-1"></a>run_imputation<span class="ot">=</span><span class="cn">FALSE</span></span>
<span id="cb26-15"><a href="data-prep.html#cb26-15" tabindex="-1"></a>  <span class="cf">if</span> (run_imputation){</span>
<span id="cb26-16"><a href="data-prep.html#cb26-16" tabindex="-1"></a>  <span class="co"># Define the path for your error log</span></span>
<span id="cb26-17"><a href="data-prep.html#cb26-17" tabindex="-1"></a>  error_log_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;imputation_failures_&quot;</span>, <span class="fu">Sys.Date</span>(), <span class="st">&quot;.log&quot;</span>)</span>
<span id="cb26-18"><a href="data-prep.html#cb26-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(error_log_file)) <span class="fu">file.remove</span>(error_log_file)</span>
<span id="cb26-19"><a href="data-prep.html#cb26-19" tabindex="-1"></a>    </span>
<span id="cb26-20"><a href="data-prep.html#cb26-20" tabindex="-1"></a>  <span class="co"># Progress bar set-up</span></span>
<span id="cb26-21"><a href="data-prep.html#cb26-21" tabindex="-1"></a>  <span class="fu">library</span>(progress)</span>
<span id="cb26-22"><a href="data-prep.html#cb26-22" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">format =</span> <span class="st">&quot;[:bar] :percent ETA: :eta&quot;</span>, <span class="at">total =</span> <span class="fu">length</span>(<span class="fu">unique</span>(df_features<span class="sc">$</span>external_id)))</span>
<span id="cb26-23"><a href="data-prep.html#cb26-23" tabindex="-1"></a>  progress <span class="ot">&lt;-</span> <span class="cf">function</span>(n){ pb<span class="sc">$</span><span class="fu">tick</span>()}</span>
<span id="cb26-24"><a href="data-prep.html#cb26-24" tabindex="-1"></a>  opts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">progress =</span> progress)</span>
<span id="cb26-25"><a href="data-prep.html#cb26-25" tabindex="-1"></a>  </span>
<span id="cb26-26"><a href="data-prep.html#cb26-26" tabindex="-1"></a>  <span class="co"># Parallel set-up</span></span>
<span id="cb26-27"><a href="data-prep.html#cb26-27" tabindex="-1"></a>  n_cores <span class="ot">=</span> <span class="fu">detectCores</span>()<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb26-28"><a href="data-prep.html#cb26-28" tabindex="-1"></a>  cl <span class="ot">=</span> <span class="fu">makeCluster</span>(n_cores)</span>
<span id="cb26-29"><a href="data-prep.html#cb26-29" tabindex="-1"></a>  <span class="fu">registerDoSNOW</span>(cl)</span>
<span id="cb26-30"><a href="data-prep.html#cb26-30" tabindex="-1"></a>  </span>
<span id="cb26-31"><a href="data-prep.html#cb26-31" tabindex="-1"></a>  <span class="co"># Parallel Run</span></span>
<span id="cb26-32"><a href="data-prep.html#cb26-32" tabindex="-1"></a>  list_imputation_results <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="fu">unique</span>(df_features<span class="sc">$</span>external_id),</span>
<span id="cb26-33"><a href="data-prep.html#cb26-33" tabindex="-1"></a>                                    <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&#39;mice&#39;</span>,<span class="st">&#39;beepr&#39;</span>, <span class="st">&quot;dplyr&quot;</span>),</span>
<span id="cb26-34"><a href="data-prep.html#cb26-34" tabindex="-1"></a>                                    <span class="at">.errorhandling =</span> <span class="st">&#39;pass&#39;</span>,</span>
<span id="cb26-35"><a href="data-prep.html#cb26-35" tabindex="-1"></a>                                    <span class="at">.options.snow =</span> opts,</span>
<span id="cb26-36"><a href="data-prep.html#cb26-36" tabindex="-1"></a>                                    <span class="at">.verbose =</span> F) <span class="sc">%dopar%</span> {</span>
<span id="cb26-37"><a href="data-prep.html#cb26-37" tabindex="-1"></a>    <span class="co"># Run function and log failures</span></span>
<span id="cb26-38"><a href="data-prep.html#cb26-38" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb26-39"><a href="data-prep.html#cb26-39" tabindex="-1"></a>      <span class="fu">impute_subject</span>(df_features, i, impute_vars )}, </span>
<span id="cb26-40"><a href="data-prep.html#cb26-40" tabindex="-1"></a>      <span class="co"># On errror:</span></span>
<span id="cb26-41"><a href="data-prep.html#cb26-41" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb26-42"><a href="data-prep.html#cb26-42" tabindex="-1"></a>        <span class="co"># Create error message</span></span>
<span id="cb26-43"><a href="data-prep.html#cb26-43" tabindex="-1"></a>        failed_id <span class="ot">&lt;-</span> i</span>
<span id="cb26-44"><a href="data-prep.html#cb26-44" tabindex="-1"></a>        error_message <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb26-45"><a href="data-prep.html#cb26-45" tabindex="-1"></a>          <span class="st">&quot;Timestamp: &quot;</span>, <span class="fu">Sys.time</span>(),</span>
<span id="cb26-46"><a href="data-prep.html#cb26-46" tabindex="-1"></a>          <span class="st">&quot;, Subject_ID: &quot;</span>, failed_id,</span>
<span id="cb26-47"><a href="data-prep.html#cb26-47" tabindex="-1"></a>          <span class="st">&quot;, Error: &quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb26-48"><a href="data-prep.html#cb26-48" tabindex="-1"></a>        <span class="co"># Append the error message to the log file</span></span>
<span id="cb26-49"><a href="data-prep.html#cb26-49" tabindex="-1"></a>        <span class="fu">cat</span>(error_message, <span class="at">file =</span> error_log_file, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-50"><a href="data-prep.html#cb26-50" tabindex="-1"></a>        </span>
<span id="cb26-51"><a href="data-prep.html#cb26-51" tabindex="-1"></a>        <span class="co"># Return NULL for the failed iteration</span></span>
<span id="cb26-52"><a href="data-prep.html#cb26-52" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb26-53"><a href="data-prep.html#cb26-53" tabindex="-1"></a>        }</span>
<span id="cb26-54"><a href="data-prep.html#cb26-54" tabindex="-1"></a>      )</span>
<span id="cb26-55"><a href="data-prep.html#cb26-55" tabindex="-1"></a>  }</span>
<span id="cb26-56"><a href="data-prep.html#cb26-56" tabindex="-1"></a>  <span class="fu">stopCluster</span>(cl)</span>
<span id="cb26-57"><a href="data-prep.html#cb26-57" tabindex="-1"></a>    </span>
<span id="cb26-58"><a href="data-prep.html#cb26-58" tabindex="-1"></a>  <span class="co"># Combine results and make an imputation column</span></span>
<span id="cb26-59"><a href="data-prep.html#cb26-59" tabindex="-1"></a>  df_features_imputed <span class="ot">=</span> <span class="fu">rbindlist</span>(list_imputation_results)</span>
<span id="cb26-60"><a href="data-prep.html#cb26-60" tabindex="-1"></a>  df_features_imputed<span class="sc">$</span>imputed <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb26-61"><a href="data-prep.html#cb26-61" tabindex="-1"></a>  </span>
<span id="cb26-62"><a href="data-prep.html#cb26-62" tabindex="-1"></a>  <span class="co"># Subset unimputed subs</span></span>
<span id="cb26-63"><a href="data-prep.html#cb26-63" tabindex="-1"></a>  impute_fail_subs <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(df_features<span class="sc">$</span>external_id, df_features_imputed<span class="sc">$</span>external_id)</span>
<span id="cb26-64"><a href="data-prep.html#cb26-64" tabindex="-1"></a>  df_features_unimputed <span class="ot">&lt;-</span> df_features[(df_features<span class="sc">$</span>external_id <span class="sc">%in%</span> impute_fail_subs),]</span>
<span id="cb26-65"><a href="data-prep.html#cb26-65" tabindex="-1"></a>  df_features_unimputed<span class="sc">$</span>imputed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-66"><a href="data-prep.html#cb26-66" tabindex="-1"></a>  </span>
<span id="cb26-67"><a href="data-prep.html#cb26-67" tabindex="-1"></a>  <span class="co"># Now put them togerther</span></span>
<span id="cb26-68"><a href="data-prep.html#cb26-68" tabindex="-1"></a>  df_features_mix <span class="ot">=</span> <span class="fu">rbind</span>(df_features_imputed, df_features_unimputed, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-69"><a href="data-prep.html#cb26-69" tabindex="-1"></a>  </span>
<span id="cb26-70"><a href="data-prep.html#cb26-70" tabindex="-1"></a>  <span class="co"># # # Impute the ones that didnt work at the between-subject level</span></span>
<span id="cb26-71"><a href="data-prep.html#cb26-71" tabindex="-1"></a>  L2_prediction_mat <span class="ot">&lt;-</span> <span class="fu">make_pred_matrix</span>(df_features_mix, <span class="at">impute_vars =</span> impute_vars)<span class="sc">$</span>pred_matrix</span>
<span id="cb26-72"><a href="data-prep.html#cb26-72" tabindex="-1"></a>  L2_prediction_mat[, <span class="st">&quot;external_id&quot;</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb26-73"><a href="data-prep.html#cb26-73" tabindex="-1"></a>  mice_imputation_2l <span class="ot">&lt;-</span> <span class="fu">mice</span>(<span class="at">data =</span> df_features_mix,</span>
<span id="cb26-74"><a href="data-prep.html#cb26-74" tabindex="-1"></a>                             <span class="at">maxit =</span> <span class="dv">2</span>,</span>
<span id="cb26-75"><a href="data-prep.html#cb26-75" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">&quot;2lonly.pmm&quot;</span>,</span>
<span id="cb26-76"><a href="data-prep.html#cb26-76" tabindex="-1"></a>                              <span class="at">seed =</span> <span class="dv">666</span>,</span>
<span id="cb26-77"><a href="data-prep.html#cb26-77" tabindex="-1"></a>                              <span class="at">blocks =</span> <span class="fu">as.list</span>(<span class="fu">rownames</span>(L2_prediction_mat)),</span>
<span id="cb26-78"><a href="data-prep.html#cb26-78" tabindex="-1"></a>                              <span class="at">predictorMatrix =</span> L2_prediction_mat)</span>
<span id="cb26-79"><a href="data-prep.html#cb26-79" tabindex="-1"></a>  </span>
<span id="cb26-80"><a href="data-prep.html#cb26-80" tabindex="-1"></a>  df_features_mix <span class="ot">&lt;-</span> <span class="fu">complete</span>(mice_imputation_2l)</span>
<span id="cb26-81"><a href="data-prep.html#cb26-81" tabindex="-1"></a>  <span class="co"># Make a day-prompt interaction for later</span></span>
<span id="cb26-82"><a href="data-prep.html#cb26-82" tabindex="-1"></a>  df_features_mix<span class="sc">$</span>day_prompt <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">interaction</span>(df_features_mix<span class="sc">$</span>day_nr, df_features_mix<span class="sc">$</span>prompt_num))</span>
<span id="cb26-83"><a href="data-prep.html#cb26-83" tabindex="-1"></a>    </span>
<span id="cb26-84"><a href="data-prep.html#cb26-84" tabindex="-1"></a>  <span class="co"># Finally save the imputed data frame </span></span>
<span id="cb26-85"><a href="data-prep.html#cb26-85" tabindex="-1"></a>  <span class="fu">fwrite</span>(df_features_mix, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;df_features_imputed.csv&#39;</span>))  </span>
<span id="cb26-86"><a href="data-prep.html#cb26-86" tabindex="-1"></a>    </span>
<span id="cb26-87"><a href="data-prep.html#cb26-87" tabindex="-1"></a>  <span class="co"># Now separate the training and test sets</span></span>
<span id="cb26-88"><a href="data-prep.html#cb26-88" tabindex="-1"></a>  df_features_mix <span class="ot">=</span> df_features_mix <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(external_id, week_nr, day_nr, imputed) </span>
<span id="cb26-89"><a href="data-prep.html#cb26-89" tabindex="-1"></a>  df_ml_train <span class="ot">=</span> df_features_mix <span class="sc">%&gt;%</span> <span class="fu">filter</span>(external_id <span class="sc">%in%</span>  training_set<span class="sc">$</span>external_id)</span>
<span id="cb26-90"><a href="data-prep.html#cb26-90" tabindex="-1"></a>  df_ml_test <span class="ot">=</span> df_features_mix <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(external_id <span class="sc">%in%</span>  training_set<span class="sc">$</span>external_id))</span>
<span id="cb26-91"><a href="data-prep.html#cb26-91" tabindex="-1"></a>  <span class="co"># Write the data</span></span>
<span id="cb26-92"><a href="data-prep.html#cb26-92" tabindex="-1"></a>  <span class="fu">fwrite</span>(df_ml_train, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;imputed_training.csv&quot;</span>))</span>
<span id="cb26-93"><a href="data-prep.html#cb26-93" tabindex="-1"></a>  <span class="fu">fwrite</span>(df_ml_test, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;imputed_testing.csv&quot;</span>))</span>
<span id="cb26-94"><a href="data-prep.html#cb26-94" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb26-95"><a href="data-prep.html#cb26-95" tabindex="-1"></a>  df_features_mix <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;df_features_imputed.csv&#39;</span>))  </span>
<span id="cb26-96"><a href="data-prep.html#cb26-96" tabindex="-1"></a>  df_ml_train <span class="ot">=</span> <span class="fu">fread</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;imputed_training.csv&quot;</span>))</span>
<span id="cb26-97"><a href="data-prep.html#cb26-97" tabindex="-1"></a>  df_ml_test <span class="ot">=</span> <span class="fu">fread</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;imputed_testing.csv&quot;</span>))</span>
<span id="cb26-98"><a href="data-prep.html#cb26-98" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="dataset-creation" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Dataset Creation<a href="data-prep.html#dataset-creation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We have completed the first part of data exploration and preparation and are now ready to start running our actual models. My aim is to first see if I can predict depression at the daily (PHQ-2) and weekly (PHQ-9) levels. I also want to see whether we can do this using EMA measures, or wearable measures. To get there, I use the Leiden University <a href="https://pubappslu.atlassian.net/wiki/spaces/HPCWIKI/pages/37519378/About+ALICE">ALICE HPC cluster</a>. The analysis is also done in <code>python</code>, so here I will prepare the data to send to the cluster as python pickles which I can then read into the cluster much more easily. Part of the preparation at this stage is to also standardize the variables within-subject. I then pivot the data to the required format.</p>
<div id="weekly-data" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Weekly Data<a href="data-prep.html#weekly-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-prep.html#cb27-1" tabindex="-1"></a><span class="co"># Pivot to wide and make matrix per variable</span></span>
<span id="cb27-2"><a href="data-prep.html#cb27-2" tabindex="-1"></a>features <span class="ot">=</span> impute_vars</span>
<span id="cb27-3"><a href="data-prep.html#cb27-3" tabindex="-1"></a>n_features <span class="ot">=</span> <span class="fu">length</span>(impute_vars)</span>
<span id="cb27-4"><a href="data-prep.html#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="data-prep.html#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="data-prep.html#cb27-6" tabindex="-1"></a><span class="do">## First for PA</span></span>
<span id="cb27-7"><a href="data-prep.html#cb27-7" tabindex="-1"></a>df_ml_lstm_week <span class="ot">=</span> df_features_mix <span class="sc">%&gt;%</span> </span>
<span id="cb27-8"><a href="data-prep.html#cb27-8" tabindex="-1"></a>  <span class="fu">select</span>(external_id, week_nr, prompt_num,  phq9_sum_w, day_nr, <span class="fu">all_of</span>(features)) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="data-prep.html#cb27-9" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(day_nr)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-10"><a href="data-prep.html#cb27-10" tabindex="-1"></a>  <span class="co"># Now we back-fill the PHQ9 items again (cause we have to)</span></span>
<span id="cb27-11"><a href="data-prep.html#cb27-11" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id, week_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb27-12"><a href="data-prep.html#cb27-12" tabindex="-1"></a>  <span class="fu">fill</span>(phq9_sum_w, <span class="at">.direction =</span> <span class="st">&#39;up&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="data-prep.html#cb27-13" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-14"><a href="data-prep.html#cb27-14" tabindex="-1"></a>  <span class="co">#  Now we rearrange and keep the distinct obesractions in case of dups</span></span>
<span id="cb27-15"><a href="data-prep.html#cb27-15" tabindex="-1"></a>  <span class="fu">arrange</span>(external_id, week_nr, day_nr, prompt_num) <span class="sc">%&gt;%</span></span>
<span id="cb27-16"><a href="data-prep.html#cb27-16" tabindex="-1"></a>  <span class="fu">distinct</span>(external_id, week_nr, day_nr, prompt_num, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-17"><a href="data-prep.html#cb27-17" tabindex="-1"></a>  <span class="co"># Now create the PHQ-9 cut-off for classification</span></span>
<span id="cb27-18"><a href="data-prep.html#cb27-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phq9_cuttoff =</span> <span class="fu">ifelse</span>(phq9_sum_w<span class="sc">&gt;</span><span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-19"><a href="data-prep.html#cb27-19" tabindex="-1"></a>  <span class="co"># Scale and center non-binary feats</span></span>
<span id="cb27-20"><a href="data-prep.html#cb27-20" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id) <span class="sc">%&gt;%</span></span>
<span id="cb27-21"><a href="data-prep.html#cb27-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(ema_day_vars, epa_vars, ema_mor_vars, <span class="st">&quot;discomfort_e&quot;</span>, <span class="st">&quot;emo_reg_e&quot;</span>, <span class="st">&quot;useful_e&quot;</span>, <span class="st">&quot;neg_exp_e&quot;</span>,<span class="st">&quot;pos_exp_e&quot;</span>)), </span>
<span id="cb27-22"><a href="data-prep.html#cb27-22" tabindex="-1"></a>                       <span class="sc">~</span> (.x <span class="sc">-</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> T))<span class="sc">/</span><span class="fu">sd</span>(.x, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-23"><a href="data-prep.html#cb27-23" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-24"><a href="data-prep.html#cb27-24" tabindex="-1"></a>   <span class="co"># Pivot Wider</span></span>
<span id="cb27-25"><a href="data-prep.html#cb27-25" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(external_id, week_nr, phq9_sum_w, phq9_cuttoff), <span class="at">names_from =</span> <span class="fu">c</span>(day_nr, prompt_num), <span class="at">values_from =</span> <span class="fu">all_of</span>(features)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-26"><a href="data-prep.html#cb27-26" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_5&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-27"><a href="data-prep.html#cb27-27" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb27-28"><a href="data-prep.html#cb27-28" tabindex="-1"></a></span>
<span id="cb27-29"><a href="data-prep.html#cb27-29" tabindex="-1"></a><span class="co"># Create training and test sets</span></span>
<span id="cb27-30"><a href="data-prep.html#cb27-30" tabindex="-1"></a>df_ml_lstm_week_train <span class="ot">=</span> df_ml_lstm_week[(df_ml_lstm_week<span class="sc">$</span>external_id <span class="sc">%in%</span> training_set<span class="sc">$</span>external_id),]</span>
<span id="cb27-31"><a href="data-prep.html#cb27-31" tabindex="-1"></a>df_ml_lstm_week_test <span class="ot">=</span> df_ml_lstm_week[<span class="sc">!</span>(df_ml_lstm_week<span class="sc">$</span>external_id <span class="sc">%in%</span> training_set<span class="sc">$</span>external_id),]</span></code></pre></div>
</div>
<div id="daily-data" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Daily Data<a href="data-prep.html#daily-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-prep.html#cb28-1" tabindex="-1"></a><span class="co"># Pivot to wide and make matrix per variable</span></span>
<span id="cb28-2"><a href="data-prep.html#cb28-2" tabindex="-1"></a>features <span class="ot">=</span>  impute_vars</span>
<span id="cb28-3"><a href="data-prep.html#cb28-3" tabindex="-1"></a>n_features <span class="ot">=</span> <span class="fu">length</span>(features)</span>
<span id="cb28-4"><a href="data-prep.html#cb28-4" tabindex="-1"></a></span>
<span id="cb28-5"><a href="data-prep.html#cb28-5" tabindex="-1"></a></span>
<span id="cb28-6"><a href="data-prep.html#cb28-6" tabindex="-1"></a><span class="do">## First for PA</span></span>
<span id="cb28-7"><a href="data-prep.html#cb28-7" tabindex="-1"></a>df_ml_lstm_day <span class="ot">=</span> df_features_mix <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="data-prep.html#cb28-8" tabindex="-1"></a>  <span class="fu">select</span>(external_id, week_nr, prompt_num,  phq2_sum_e, day_nr, <span class="fu">all_of</span>(features)) <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="data-prep.html#cb28-9" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(day_nr)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-10"><a href="data-prep.html#cb28-10" tabindex="-1"></a>  <span class="co"># Now we back-fill the PHQ9 items again (cause we have to)</span></span>
<span id="cb28-11"><a href="data-prep.html#cb28-11" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id, week_nr, day_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb28-12"><a href="data-prep.html#cb28-12" tabindex="-1"></a>  <span class="fu">fill</span>(phq2_sum_e, <span class="at">.direction =</span> <span class="st">&#39;up&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="data-prep.html#cb28-13" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-14"><a href="data-prep.html#cb28-14" tabindex="-1"></a>  <span class="co">#  Now we rearrange and keep the distinct obesractions in case of dups</span></span>
<span id="cb28-15"><a href="data-prep.html#cb28-15" tabindex="-1"></a>  <span class="fu">arrange</span>(external_id, week_nr, day_nr, prompt_num) <span class="sc">%&gt;%</span></span>
<span id="cb28-16"><a href="data-prep.html#cb28-16" tabindex="-1"></a>  <span class="fu">distinct</span>(external_id, week_nr, day_nr, prompt_num, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="data-prep.html#cb28-17" tabindex="-1"></a>  <span class="co"># Scale and center</span></span>
<span id="cb28-18"><a href="data-prep.html#cb28-18" tabindex="-1"></a>  <span class="fu">group_by</span>(external_id) <span class="sc">%&gt;%</span> </span>
<span id="cb28-19"><a href="data-prep.html#cb28-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(features[<span class="sc">-</span><span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">&quot;cat&quot;</span>, features), <span class="fu">grep</span>(<span class="st">&quot;substance&quot;</span>, features))]),</span>
<span id="cb28-20"><a href="data-prep.html#cb28-20" tabindex="-1"></a>                <span class="sc">~</span> (.x <span class="sc">-</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> T))<span class="sc">/</span><span class="fu">sd</span>(.x, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb28-21"><a href="data-prep.html#cb28-21" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-22"><a href="data-prep.html#cb28-22" tabindex="-1"></a>  <span class="co"># Pivot Wider</span></span>
<span id="cb28-23"><a href="data-prep.html#cb28-23" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(external_id, week_nr, day_nr, phq2_sum_e), <span class="at">names_from =</span> <span class="fu">c</span>(prompt_num), <span class="at">values_from =</span> features) <span class="sc">%&gt;%</span> </span>
<span id="cb28-24"><a href="data-prep.html#cb28-24" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_5&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-25"><a href="data-prep.html#cb28-25" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb28-26"><a href="data-prep.html#cb28-26" tabindex="-1"></a></span>
<span id="cb28-27"><a href="data-prep.html#cb28-27" tabindex="-1"></a><span class="co"># Create training and test sets</span></span>
<span id="cb28-28"><a href="data-prep.html#cb28-28" tabindex="-1"></a>df_ml_lstm_day_train <span class="ot">=</span> df_ml_lstm_day[(df_ml_lstm_day<span class="sc">$</span>external_id <span class="sc">%in%</span> training_set<span class="sc">$</span>external_id),]</span>
<span id="cb28-29"><a href="data-prep.html#cb28-29" tabindex="-1"></a>df_ml_lstm_day_test <span class="ot">=</span> df_ml_lstm_day[<span class="sc">!</span>(df_ml_lstm_day<span class="sc">$</span>external_id <span class="sc">%in%</span> training_set<span class="sc">$</span>external_id),]</span></code></pre></div>
</div>
</div>
<div id="dataset-export" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Dataset Export<a href="data-prep.html#dataset-export" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We now save the data as a python object since we run the final models there. We do this iteratively over the week/day and train/test data in a function format. This creates the following for each combination of the previously mentioned:</p>
<ul>
<li>*_sub: A file containing the subject rows for grouping purposes later.</li>
<li>*_phq: A file with the Y outcomes</li>
<li>*_ema: A file with the EMA features</li>
<li>vars*: A file with the variable names for SHAP estimations and such</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-prep.html#cb29-1" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb29-2"><a href="data-prep.html#cb29-2" tabindex="-1"></a><span class="co"># Make sublists</span></span>
<span id="cb29-3"><a href="data-prep.html#cb29-3" tabindex="-1"></a>week_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-4"><a href="data-prep.html#cb29-4" tabindex="-1"></a>  <span class="at">train =</span> df_ml_lstm_week_train,</span>
<span id="cb29-5"><a href="data-prep.html#cb29-5" tabindex="-1"></a>  <span class="at">val =</span> df_ml_lstm_week_test</span>
<span id="cb29-6"><a href="data-prep.html#cb29-6" tabindex="-1"></a>  )</span>
<span id="cb29-7"><a href="data-prep.html#cb29-7" tabindex="-1"></a>day_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-8"><a href="data-prep.html#cb29-8" tabindex="-1"></a>  <span class="at">train =</span> df_ml_lstm_day_train,</span>
<span id="cb29-9"><a href="data-prep.html#cb29-9" tabindex="-1"></a>  <span class="at">val =</span> df_ml_lstm_day_test</span>
<span id="cb29-10"><a href="data-prep.html#cb29-10" tabindex="-1"></a>  )</span>
<span id="cb29-11"><a href="data-prep.html#cb29-11" tabindex="-1"></a>var_lists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-12"><a href="data-prep.html#cb29-12" tabindex="-1"></a>  <span class="at">ema =</span> ema_vars,</span>
<span id="cb29-13"><a href="data-prep.html#cb29-13" tabindex="-1"></a>  <span class="at">epa =</span> epa_vars,</span>
<span id="cb29-14"><a href="data-prep.html#cb29-14" tabindex="-1"></a>  <span class="at">all =</span> <span class="fu">c</span>(ema_vars, epa_vars)</span>
<span id="cb29-15"><a href="data-prep.html#cb29-15" tabindex="-1"></a>  )</span>
<span id="cb29-16"><a href="data-prep.html#cb29-16" tabindex="-1"></a></span>
<span id="cb29-17"><a href="data-prep.html#cb29-17" tabindex="-1"></a></span>
<span id="cb29-18"><a href="data-prep.html#cb29-18" tabindex="-1"></a>pickle_jar <span class="ot">=</span> <span class="cn">TRUE</span> <span class="co"># TO avoid rewriting the OG data everytime we knit</span></span>
<span id="cb29-19"><a href="data-prep.html#cb29-19" tabindex="-1"></a><span class="cf">if</span> (pickle_jar){</span>
<span id="cb29-20"><a href="data-prep.html#cb29-20" tabindex="-1"></a>  <span class="co"># Then inside the loop, you just need one line:</span></span>
<span id="cb29-21"><a href="data-prep.html#cb29-21" tabindex="-1"></a>  <span class="cf">for</span> (timeframe <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;week&quot;</span>, <span class="st">&quot;day&quot;</span>)){</span>
<span id="cb29-22"><a href="data-prep.html#cb29-22" tabindex="-1"></a>    <span class="co"># Specify data to use  </span></span>
<span id="cb29-23"><a href="data-prep.html#cb29-23" tabindex="-1"></a>    <span class="cf">if</span>(timeframe <span class="sc">==</span> <span class="st">&quot;week&quot;</span>){</span>
<span id="cb29-24"><a href="data-prep.html#cb29-24" tabindex="-1"></a>      tmp_list <span class="ot">&lt;-</span> week_list</span>
<span id="cb29-25"><a href="data-prep.html#cb29-25" tabindex="-1"></a>      outcome <span class="ot">=</span> <span class="st">&#39;phq9_sum_w&#39;</span></span>
<span id="cb29-26"><a href="data-prep.html#cb29-26" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(timeframe <span class="sc">==</span> <span class="st">&#39;day&#39;</span>){</span>
<span id="cb29-27"><a href="data-prep.html#cb29-27" tabindex="-1"></a>      tmp_list <span class="ot">&lt;-</span> day_list</span>
<span id="cb29-28"><a href="data-prep.html#cb29-28" tabindex="-1"></a>      outcome <span class="ot">=</span> <span class="st">&#39;phq2_sum_e&#39;</span></span>
<span id="cb29-29"><a href="data-prep.html#cb29-29" tabindex="-1"></a>    }</span>
<span id="cb29-30"><a href="data-prep.html#cb29-30" tabindex="-1"></a>    <span class="co"># Now do the train/test stuff</span></span>
<span id="cb29-31"><a href="data-prep.html#cb29-31" tabindex="-1"></a>    <span class="cf">for</span>(train_test <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;train&quot;</span>, <span class="st">&quot;val&quot;</span>)){ </span>
<span id="cb29-32"><a href="data-prep.html#cb29-32" tabindex="-1"></a>      tmp_data <span class="ot">&lt;-</span> tmp_list[[train_test]]</span>
<span id="cb29-33"><a href="data-prep.html#cb29-33" tabindex="-1"></a>      <span class="do">## Save subject IDs and outcomes</span></span>
<span id="cb29-34"><a href="data-prep.html#cb29-34" tabindex="-1"></a>      tmp_data <span class="sc">%&gt;%</span> </span>
<span id="cb29-35"><a href="data-prep.html#cb29-35" tabindex="-1"></a>        <span class="fu">select</span>(external_id) <span class="sc">%&gt;%</span></span>
<span id="cb29-36"><a href="data-prep.html#cb29-36" tabindex="-1"></a>        <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-37"><a href="data-prep.html#cb29-37" tabindex="-1"></a>        <span class="fu">py_save_object</span>(<span class="fu">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;pickles&#39;</span>, <span class="fu">paste0</span>(timeframe, <span class="st">&#39;_&#39;</span>, train_test, <span class="st">&#39;_subs.pickle&#39;</span>)))</span>
<span id="cb29-38"><a href="data-prep.html#cb29-38" tabindex="-1"></a>      <span class="do">## Outcome</span></span>
<span id="cb29-39"><a href="data-prep.html#cb29-39" tabindex="-1"></a>      tmp_data <span class="sc">%&gt;%</span> </span>
<span id="cb29-40"><a href="data-prep.html#cb29-40" tabindex="-1"></a>        <span class="fu">select</span>(<span class="fu">all_of</span>(outcome)) <span class="sc">%&gt;%</span></span>
<span id="cb29-41"><a href="data-prep.html#cb29-41" tabindex="-1"></a>        <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-42"><a href="data-prep.html#cb29-42" tabindex="-1"></a>        <span class="fu">py_save_object</span>(<span class="fu">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;pickles&#39;</span>, <span class="fu">paste0</span>(timeframe, <span class="st">&#39;_&#39;</span>, train_test, <span class="st">&#39;_phq.pickle&#39;</span>)))</span>
<span id="cb29-43"><a href="data-prep.html#cb29-43" tabindex="-1"></a>      <span class="co"># Make the lagged-phq9 predictor</span></span>
<span id="cb29-44"><a href="data-prep.html#cb29-44" tabindex="-1"></a>      tmp_data <span class="sc">%&gt;%</span> </span>
<span id="cb29-45"><a href="data-prep.html#cb29-45" tabindex="-1"></a>        <span class="fu">group_by</span>(external_id) <span class="sc">%&gt;%</span> </span>
<span id="cb29-46"><a href="data-prep.html#cb29-46" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(outcome), <span class="cf">function</span>(.x) {</span>
<span id="cb29-47"><a href="data-prep.html#cb29-47" tabindex="-1"></a>            lagged_x <span class="ot">&lt;-</span> <span class="fu">lag</span>(.x)</span>
<span id="cb29-48"><a href="data-prep.html#cb29-48" tabindex="-1"></a>            <span class="co"># Calculate median *once* to avoid re-computing</span></span>
<span id="cb29-49"><a href="data-prep.html#cb29-49" tabindex="-1"></a>            median_val <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">median</span>(<span class="fu">na.omit</span>(lagged_x))) </span>
<span id="cb29-50"><a href="data-prep.html#cb29-50" tabindex="-1"></a>            lagged_x <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(lagged_x), median_val, lagged_x)</span>
<span id="cb29-51"><a href="data-prep.html#cb29-51" tabindex="-1"></a>            <span class="fu">return</span>(lagged_x)</span>
<span id="cb29-52"><a href="data-prep.html#cb29-52" tabindex="-1"></a>          }, <span class="at">.names =</span> <span class="st">&quot;{.col}_lag1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-53"><a href="data-prep.html#cb29-53" tabindex="-1"></a>        <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-54"><a href="data-prep.html#cb29-54" tabindex="-1"></a>        <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">paste0</span>(outcome, <span class="st">&quot;_lag1&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb29-55"><a href="data-prep.html#cb29-55" tabindex="-1"></a>        <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-56"><a href="data-prep.html#cb29-56" tabindex="-1"></a>        <span class="fu">py_save_object</span>(<span class="fu">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;pickles&#39;</span>, <span class="fu">paste0</span>(timeframe, <span class="st">&#39;_&#39;</span>, train_test, <span class="st">&#39;_phq_lag1.pickle&#39;</span>)))</span>
<span id="cb29-57"><a href="data-prep.html#cb29-57" tabindex="-1"></a>      <span class="co"># Now we make the predictor matrices</span></span>
<span id="cb29-58"><a href="data-prep.html#cb29-58" tabindex="-1"></a>      <span class="cf">for</span> (data <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;ema&quot;</span>, <span class="st">&quot;epa&quot;</span>, <span class="st">&quot;all&quot;</span>)){</span>
<span id="cb29-59"><a href="data-prep.html#cb29-59" tabindex="-1"></a>        var_list <span class="ot">&lt;-</span> var_lists[[data]]</span>
<span id="cb29-60"><a href="data-prep.html#cb29-60" tabindex="-1"></a>        <span class="fu">feature_mat</span>(tmp_data, <span class="at">vars =</span> var_list) <span class="sc">%&gt;%</span></span>
<span id="cb29-61"><a href="data-prep.html#cb29-61" tabindex="-1"></a>          reticulate<span class="sc">::</span><span class="fu">r_to_py</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-62"><a href="data-prep.html#cb29-62" tabindex="-1"></a>          <span class="fu">py_save_object</span>( <span class="fu">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;pickles&#39;</span>, <span class="fu">paste0</span>(timeframe, <span class="st">&#39;_&#39;</span>, train_test, <span class="st">&#39;_&#39;</span>, data, <span class="st">&#39;.pickle&#39;</span>)))</span>
<span id="cb29-63"><a href="data-prep.html#cb29-63" tabindex="-1"></a>      }</span>
<span id="cb29-64"><a href="data-prep.html#cb29-64" tabindex="-1"></a>    }</span>
<span id="cb29-65"><a href="data-prep.html#cb29-65" tabindex="-1"></a>  }</span>
<span id="cb29-66"><a href="data-prep.html#cb29-66" tabindex="-1"></a>}</span>
<span id="cb29-67"><a href="data-prep.html#cb29-67" tabindex="-1"></a></span>
<span id="cb29-68"><a href="data-prep.html#cb29-68" tabindex="-1"></a><span class="co"># And now we do the variable list separtely</span></span>
<span id="cb29-69"><a href="data-prep.html#cb29-69" tabindex="-1"></a><span class="cf">for</span> (data <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;ema&quot;</span>, <span class="st">&quot;epa&quot;</span>, <span class="st">&quot;all&quot;</span>)){</span>
<span id="cb29-70"><a href="data-prep.html#cb29-70" tabindex="-1"></a>   var_list <span class="ot">&lt;-</span> var_lists[[data]]</span>
<span id="cb29-71"><a href="data-prep.html#cb29-71" tabindex="-1"></a>   var_list <span class="sc">%&gt;%</span> </span>
<span id="cb29-72"><a href="data-prep.html#cb29-72" tabindex="-1"></a>     <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-73"><a href="data-prep.html#cb29-73" tabindex="-1"></a>     <span class="fu">py_save_object</span>(<span class="fu">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;pickles&#39;</span>, <span class="fu">paste0</span>(<span class="st">&#39;vars_&#39;</span>, data, <span class="st">&#39;.pickle&#39;</span>)))</span>
<span id="cb29-74"><a href="data-prep.html#cb29-74" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-testing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
