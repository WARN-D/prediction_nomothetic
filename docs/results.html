<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Results | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study</title>
  <meta name="description" content="4 Results | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Results | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Results | Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study" />
  
  
  

<meta name="author" content="Rayyan Tutunji" />


<meta name="date" content="2025-11-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-testing.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-prep.html"><a href="data-prep.html"><i class="fa fa-check"></i><b>2</b> Data Prep</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-prep.html"><a href="data-prep.html#processing"><i class="fa fa-check"></i><b>2.1</b> Processing</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-prep.html"><a href="data-prep.html#daily-features"><i class="fa fa-check"></i><b>2.1.1</b> Daily Features</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-prep.html"><a href="data-prep.html#morningevening-features"><i class="fa fa-check"></i><b>2.1.2</b> Morning/Evening Features</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-prep.html"><a href="data-prep.html#weekly-features"><i class="fa fa-check"></i><b>2.1.3</b> Weekly Features</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-prep.html"><a href="data-prep.html#compliance-estimates"><i class="fa fa-check"></i><b>2.1.4</b> Compliance Estimates</a></li>
<li class="chapter" data-level="2.1.5" data-path="data-prep.html"><a href="data-prep.html#data-merger"><i class="fa fa-check"></i><b>2.1.5</b> Data Merger</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-prep.html"><a href="data-prep.html#descriptives"><i class="fa fa-check"></i><b>2.2</b> Descriptives</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-prep.html"><a href="data-prep.html#demographics"><i class="fa fa-check"></i><b>2.2.1</b> Demographics</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-prep.html"><a href="data-prep.html#compliance-rates"><i class="fa fa-check"></i><b>2.2.2</b> Compliance Rates</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-prep.html"><a href="data-prep.html#feature-correlations"><i class="fa fa-check"></i><b>2.2.3</b> Feature Correlations</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-prep.html"><a href="data-prep.html#imputation"><i class="fa fa-check"></i><b>2.3</b> Imputation</a></li>
<li class="chapter" data-level="2.4" data-path="data-prep.html"><a href="data-prep.html#dataset-creation"><i class="fa fa-check"></i><b>2.4</b> Dataset Creation</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data-prep.html"><a href="data-prep.html#weekly-data"><i class="fa fa-check"></i><b>2.4.1</b> Weekly Data</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-prep.html"><a href="data-prep.html#daily-data"><i class="fa fa-check"></i><b>2.4.2</b> Daily Data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-prep.html"><a href="data-prep.html#dataset-export"><i class="fa fa-check"></i><b>2.5</b> Dataset Export</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-testing.html"><a href="model-testing.html"><i class="fa fa-check"></i><b>3</b> Model Testing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="model-testing.html"><a href="model-testing.html#model-predictions"><i class="fa fa-check"></i><b>3.1</b> Model Predictions</a></li>
<li class="chapter" data-level="3.2" data-path="model-testing.html"><a href="model-testing.html#shap-estimate"><i class="fa fa-check"></i><b>3.2</b> SHAP Estimate</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>4</b> Results</a>
<ul>
<li class="chapter" data-level="4.1" data-path="results.html"><a href="results.html#model-performance"><i class="fa fa-check"></i><b>4.1</b> Model Performance</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="results.html"><a href="results.html#training-cv"><i class="fa fa-check"></i><b>4.1.1</b> Training CV</a></li>
<li class="chapter" data-level="4.1.2" data-path="results.html"><a href="results.html#test-data"><i class="fa fa-check"></i><b>4.1.2</b> Test Data</a></li>
<li class="chapter" data-level="4.1.3" data-path="results.html"><a href="results.html#full-results"><i class="fa fa-check"></i><b>4.1.3</b> Full Results</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="results.html"><a href="results.html#idiographic-model-performance"><i class="fa fa-check"></i><b>4.2</b> Idiographic Model Performance</a></li>
<li class="chapter" data-level="4.3" data-path="results.html"><a href="results.html#shap"><i class="fa fa-check"></i><b>4.3</b> SHAP</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="results.html"><a href="results.html#top-10-daily"><i class="fa fa-check"></i><b>4.3.1</b> Top 10 Daily</a></li>
<li class="chapter" data-level="4.3.2" data-path="results.html"><a href="results.html#top-10-weekly"><i class="fa fa-check"></i><b>4.3.2</b> Top 10 Weekly</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="results.html"><a href="results.html#supp-analysis"><i class="fa fa-check"></i><b>4.4</b> Supp Analysis</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="results.html"><a href="results.html#phq-9-autoregressive-model"><i class="fa fa-check"></i><b>4.4.1</b> PHQ-9 Autoregressive Model</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integrating ecological momentary and passive sensing data to improve depression severity prediction: insights from the WARN-D study</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="results" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Results<a href="results.html#results" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section, I create summary statistics and figures from the models we ran on the cluster. I first look at model performance statistics, look at idiographic estimates, and then make some plots for the paper.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="results.html#cb36-1" tabindex="-1"></a><span class="co"># Data wrangling</span></span>
<span id="cb36-2"><a href="results.html#cb36-2" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb36-3"><a href="results.html#cb36-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-4"><a href="results.html#cb36-4" tabindex="-1"></a><span class="co"># Stats</span></span>
<span id="cb36-5"><a href="results.html#cb36-5" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb36-6"><a href="results.html#cb36-6" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb36-7"><a href="results.html#cb36-7" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb36-8"><a href="results.html#cb36-8" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb36-9"><a href="results.html#cb36-9" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-10"><a href="results.html#cb36-10" tabindex="-1"></a><span class="fu">library</span>(ggtext) </span>
<span id="cb36-11"><a href="results.html#cb36-11" tabindex="-1"></a><span class="fu">library</span>(ggbeeswarm)</span>
<span id="cb36-12"><a href="results.html#cb36-12" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb36-13"><a href="results.html#cb36-13" tabindex="-1"></a></span>
<span id="cb36-14"><a href="results.html#cb36-14" tabindex="-1"></a><span class="co"># Fonts</span></span>
<span id="cb36-15"><a href="results.html#cb36-15" tabindex="-1"></a><span class="fu">library</span>(sysfonts)</span>
<span id="cb36-16"><a href="results.html#cb36-16" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb36-17"><a href="results.html#cb36-17" tabindex="-1"></a></span>
<span id="cb36-18"><a href="results.html#cb36-18" tabindex="-1"></a><span class="co"># Font stuffies</span></span>
<span id="cb36-19"><a href="results.html#cb36-19" tabindex="-1"></a><span class="co"># font_add(&quot;fa&quot;, &quot;figures/fa-regular-400.ttf&quot;)</span></span>
<span id="cb36-20"><a href="results.html#cb36-20" tabindex="-1"></a><span class="fu">font_add</span>(<span class="st">&quot;SegoeUIEmoji&quot;</span>, <span class="st">&quot;C:/Windows/Fonts/seguiemj.ttf&quot;</span>)  </span>
<span id="cb36-21"><a href="results.html#cb36-21" tabindex="-1"></a><span class="fu">font_add</span>(<span class="st">&quot;SegoeSymb&quot;</span>, <span class="st">&quot;C:/Windows/Fonts/seguisym.ttf&quot;</span>) </span>
<span id="cb36-22"><a href="results.html#cb36-22" tabindex="-1"></a><span class="fu">font_add</span>(<span class="st">&quot;SegoeIcons&quot;</span>, <span class="st">&quot;C:/Windows/Fonts/SegoeIcons.ttf&quot;</span>)</span>
<span id="cb36-23"><a href="results.html#cb36-23" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;SegoeIcons&quot;</span>))</span>
<span id="cb36-24"><a href="results.html#cb36-24" tabindex="-1"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb36-25"><a href="results.html#cb36-25" tabindex="-1"></a></span>
<span id="cb36-26"><a href="results.html#cb36-26" tabindex="-1"></a><span class="co"># Functions</span></span>
<span id="cb36-27"><a href="results.html#cb36-27" tabindex="-1"></a>confidence_interval <span class="ot">&lt;-</span> <span class="cf">function</span>(vector, interval) {</span>
<span id="cb36-28"><a href="results.html#cb36-28" tabindex="-1"></a>  <span class="co"># Standard deviation of sample</span></span>
<span id="cb36-29"><a href="results.html#cb36-29" tabindex="-1"></a>  vec_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(vector)</span>
<span id="cb36-30"><a href="results.html#cb36-30" tabindex="-1"></a>  <span class="co"># Sample size</span></span>
<span id="cb36-31"><a href="results.html#cb36-31" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(vector)</span>
<span id="cb36-32"><a href="results.html#cb36-32" tabindex="-1"></a>  <span class="co"># Mean of sample</span></span>
<span id="cb36-33"><a href="results.html#cb36-33" tabindex="-1"></a>  vec_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(vector)</span>
<span id="cb36-34"><a href="results.html#cb36-34" tabindex="-1"></a>  <span class="co"># Error according to t distribution</span></span>
<span id="cb36-35"><a href="results.html#cb36-35" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">qt</span>((interval <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> vec_sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb36-36"><a href="results.html#cb36-36" tabindex="-1"></a>  <span class="co"># Confidence interval as a vector</span></span>
<span id="cb36-37"><a href="results.html#cb36-37" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lower&quot;</span> <span class="ot">=</span> vec_mean <span class="sc">-</span> error, <span class="st">&quot;upper&quot;</span> <span class="ot">=</span> vec_mean <span class="sc">+</span> error)</span>
<span id="cb36-38"><a href="results.html#cb36-38" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb36-39"><a href="results.html#cb36-39" tabindex="-1"></a>}</span></code></pre></div>
<div id="model-performance" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Model Performance<a href="results.html#model-performance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First check the model performance. I do this by loading the model results as csvs which contain the predictions and actual scores for each of the training and test set, then estimating the mean error (ME), mean absolute error (MAE), mean absolute percent error (MAPE), root mean square error (RMSE), and R^2. R^2 is our primary metric of interest here as its the easiest to interpret for psychologists (our target audience).</p>
<div id="training-cv" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Training CV<a href="results.html#training-cv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="results.html#cb37-1" tabindex="-1"></a><span class="co"># Load the results from the training CV</span></span>
<span id="cb37-2"><a href="results.html#cb37-2" tabindex="-1"></a>training_cv <span class="ot">=</span> <span class="fu">Sys.glob</span>(<span class="st">&quot;C:/Users/rayya/Nextcloud/FSW_WARN-D (Projectfolder)/group/raytut/projects/prediction_nomothetic/results/results_training*.csv&quot;</span>)</span>
<span id="cb37-3"><a href="results.html#cb37-3" tabindex="-1"></a></span>
<span id="cb37-4"><a href="results.html#cb37-4" tabindex="-1"></a><span class="co"># Read all results into a df</span></span>
<span id="cb37-5"><a href="results.html#cb37-5" tabindex="-1"></a>df_val <span class="ot">=</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(training_cv, fread))</span>
<span id="cb37-6"><a href="results.html#cb37-6" tabindex="-1"></a>df_val <span class="ot">&lt;-</span> df_val <span class="sc">%&gt;%</span> </span>
<span id="cb37-7"><a href="results.html#cb37-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">factor</span>(source, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;ema&#39;</span>,<span class="st">&#39;epa&#39;</span>, <span class="st">&#39;all&#39;</span>, <span class="st">&quot;phq_lag1&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="results.html#cb37-8" tabindex="-1"></a>  <span class="fu">group_by</span>(sub_id, fold, model, source) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="results.html#cb37-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(actual))</span>
<span id="cb37-10"><a href="results.html#cb37-10" tabindex="-1"></a></span>
<span id="cb37-11"><a href="results.html#cb37-11" tabindex="-1"></a>df_val <span class="sc">%&gt;%</span> </span>
<span id="cb37-12"><a href="results.html#cb37-12" tabindex="-1"></a>  <span class="fu">group_by</span>(fold, model, source) <span class="sc">%&gt;%</span>  </span>
<span id="cb37-13"><a href="results.html#cb37-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">R2 =</span> <span class="fu">R2</span>(predicted, actual)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-14"><a href="results.html#cb37-14" tabindex="-1"></a>  <span class="fu">group_by</span>(model, source) <span class="sc">%&gt;%</span></span>
<span id="cb37-15"><a href="results.html#cb37-15" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">R2_sd =</span> <span class="fu">sd</span>(R2, <span class="at">na.rm=</span>T)) <span class="ot">-&gt;</span> train_r2sd</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;model&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="results.html#cb39-1" tabindex="-1"></a><span class="co"># Create a summary table </span></span>
<span id="cb39-2"><a href="results.html#cb39-2" tabindex="-1"></a>df_val_summ <span class="ot">&lt;-</span> df_val <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="results.html#cb39-3" tabindex="-1"></a>  <span class="fu">group_by</span>(model, source) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="results.html#cb39-4" tabindex="-1"></a>  <span class="fu">arrange</span>(model, source) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="results.html#cb39-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">round</span>(predicted)) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="results.html#cb39-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ME =</span> (<span class="fu">mean</span>(predicted<span class="sc">-</span>actual)),</span>
<span id="cb39-7"><a href="results.html#cb39-7" tabindex="-1"></a>            <span class="at">ME_CI_L =</span> <span class="fu">confidence_interval</span>((predicted<span class="sc">-</span>actual), <span class="fl">0.95</span>)[<span class="dv">1</span>],</span>
<span id="cb39-8"><a href="results.html#cb39-8" tabindex="-1"></a>            <span class="at">ME_CI_U =</span> <span class="fu">confidence_interval</span>((predicted<span class="sc">-</span>actual), <span class="fl">0.95</span>)[<span class="dv">2</span>],</span>
<span id="cb39-9"><a href="results.html#cb39-9" tabindex="-1"></a>            <span class="at">MAE =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predicted<span class="sc">-</span>actual)),</span>
<span id="cb39-10"><a href="results.html#cb39-10" tabindex="-1"></a>            <span class="at">MAPE =</span> (<span class="fu">mean</span>(<span class="fu">abs</span>(predicted<span class="sc">-</span>actual)<span class="sc">/</span>actual))<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb39-11"><a href="results.html#cb39-11" tabindex="-1"></a>            <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predicted, actual),</span>
<span id="cb39-12"><a href="results.html#cb39-12" tabindex="-1"></a>            <span class="at">R2 =</span> <span class="fu">R2</span>(predicted, actual)) <span class="sc">%&gt;%</span></span>
<span id="cb39-13"><a href="results.html#cb39-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="fu">c</span>(ME, ME_CI_L, MAE, ME_CI_U, MAPE, RMSE, R2), <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;model&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="results.html#cb41-1" tabindex="-1"></a>df_val_summ <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_val_summ, train_r2sd, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;model&quot;</span>, <span class="st">&quot;source&quot;</span>))</span>
<span id="cb41-2"><a href="results.html#cb41-2" tabindex="-1"></a>df_val_summ</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":["source"],"name":[2],"type":["fct"],"align":["left"]},{"label":["ME"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ME_CI_L"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["ME_CI_U"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["MAE"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["MAPE"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["RMSE"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["R2"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["R2_sd"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"day","2":"all","3":"-0.36","4":"-0.37","5":"-0.34","6":"1.63","7":"28.45","8":"2.25","9":"0.38","10":"0.018149171"},{"1":"day","2":"ema","3":"-0.39","4":"-0.41","5":"-0.37","6":"1.61","7":"28.00","8":"2.24","9":"0.38","10":"0.017863151"},{"1":"day","2":"epa","3":"-0.65","4":"-0.67","5":"-0.63","6":"2.17","7":"38.96","8":"2.84","9":"0.01","10":"0.006036777"},{"1":"day","2":"phq_lag1","3":"-0.94","4":"-0.96","5":"-0.92","6":"1.90","7":"30.89","8":"2.65","9":"0.20","10":"0.044770439"},{"1":"week","2":"all","3":"-0.80","4":"-0.89","5":"-0.70","6":"3.22","7":"67.56","8":"4.32","9":"0.21","10":"0.040886633"},{"1":"week","2":"ema","3":"-0.58","4":"-0.67","5":"-0.48","6":"3.21","7":"70.32","8":"4.24","9":"0.22","10":"0.043853329"},{"1":"week","2":"epa","3":"-0.90","4":"-1.00","5":"-0.79","6":"3.66","7":"85.14","8":"4.80","9":"0.01","10":"0.008112978"},{"1":"week","2":"phq_lag1","3":"-0.26","4":"-0.33","5":"-0.19","6":"2.27","7":"46.61","8":"3.12","9":"0.57","10":"0.044150275"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="results.html#cb42-1" tabindex="-1"></a>df_val_summ<span class="sc">$</span>set <span class="ot">=</span> <span class="st">&quot;cv&quot;</span></span></code></pre></div>
</div>
<div id="test-data" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Test Data<a href="results.html#test-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="results.html#cb43-1" tabindex="-1"></a>test_cv <span class="ot">=</span> <span class="fu">Sys.glob</span>(<span class="st">&quot;C:/Users/rayya/Nextcloud/FSW_WARN-D (Projectfolder)/group/raytut/projects/prediction_nomothetic/results/results_testing_*.csv&quot;</span>)</span>
<span id="cb43-2"><a href="results.html#cb43-2" tabindex="-1"></a></span>
<span id="cb43-3"><a href="results.html#cb43-3" tabindex="-1"></a><span class="co"># Read all results into a df</span></span>
<span id="cb43-4"><a href="results.html#cb43-4" tabindex="-1"></a>df_test <span class="ot">=</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(test_cv, fread), <span class="at">fill=</span>T)</span>
<span id="cb43-5"><a href="results.html#cb43-5" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> </span>
<span id="cb43-6"><a href="results.html#cb43-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">factor</span>(source, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;ema&#39;</span>,<span class="st">&#39;epa&#39;</span>, <span class="st">&#39;all&#39;</span>, <span class="st">&quot;phq_lag1&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb43-7"><a href="results.html#cb43-7" tabindex="-1"></a>  <span class="fu">group_by</span>(sub_id, fold, model, source) <span class="sc">%&gt;%</span></span>
<span id="cb43-8"><a href="results.html#cb43-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(actual)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-9"><a href="results.html#cb43-9" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb43-10"><a href="results.html#cb43-10" tabindex="-1"></a></span>
<span id="cb43-11"><a href="results.html#cb43-11" tabindex="-1"></a>df_test <span class="sc">%&gt;%</span> </span>
<span id="cb43-12"><a href="results.html#cb43-12" tabindex="-1"></a>  <span class="fu">group_by</span>(fold, model, source) <span class="sc">%&gt;%</span>  </span>
<span id="cb43-13"><a href="results.html#cb43-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">R2 =</span> <span class="fu">R2</span>(predicted, actual)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-14"><a href="results.html#cb43-14" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-15"><a href="results.html#cb43-15" tabindex="-1"></a>  <span class="fu">group_by</span>(model, source) <span class="sc">%&gt;%</span></span>
<span id="cb43-16"><a href="results.html#cb43-16" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">R2_sd =</span> <span class="fu">sd</span>(R2, <span class="at">na.rm=</span>T)) <span class="ot">-&gt;</span> testr2_sds</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;model&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="results.html#cb45-1" tabindex="-1"></a><span class="co"># Create a summary table </span></span>
<span id="cb45-2"><a href="results.html#cb45-2" tabindex="-1"></a>df_test_summ <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="results.html#cb45-3" tabindex="-1"></a>  <span class="fu">group_by</span>(model, source) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="results.html#cb45-4" tabindex="-1"></a>  <span class="fu">arrange</span>(model, source) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="results.html#cb45-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">round</span>(predicted)) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="results.html#cb45-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ME =</span> (<span class="fu">mean</span>(predicted<span class="sc">-</span>actual)),</span>
<span id="cb45-7"><a href="results.html#cb45-7" tabindex="-1"></a>            <span class="at">ME_CI_L =</span> <span class="fu">confidence_interval</span>((predicted<span class="sc">-</span>actual), <span class="fl">0.95</span>)[<span class="dv">1</span>],</span>
<span id="cb45-8"><a href="results.html#cb45-8" tabindex="-1"></a>            <span class="at">ME_CI_U =</span> <span class="fu">confidence_interval</span>((predicted<span class="sc">-</span>actual), <span class="fl">0.95</span>)[<span class="dv">2</span>],</span>
<span id="cb45-9"><a href="results.html#cb45-9" tabindex="-1"></a>            <span class="at">MAE =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predicted<span class="sc">-</span>actual)),</span>
<span id="cb45-10"><a href="results.html#cb45-10" tabindex="-1"></a>            <span class="at">MAPE =</span> (<span class="fu">mean</span>(<span class="fu">abs</span>(predicted<span class="sc">-</span>actual)<span class="sc">/</span>actual))<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb45-11"><a href="results.html#cb45-11" tabindex="-1"></a>            <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predicted, actual),</span>
<span id="cb45-12"><a href="results.html#cb45-12" tabindex="-1"></a>            <span class="at">R2 =</span> <span class="fu">R2</span>(predicted, actual)) <span class="sc">%&gt;%</span></span>
<span id="cb45-13"><a href="results.html#cb45-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="fu">c</span>(ME, ME_CI_L, MAE, ME_CI_U, MAPE, RMSE, R2), <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;model&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="results.html#cb47-1" tabindex="-1"></a><span class="co"># Add the folde R2 SDs and print summary</span></span>
<span id="cb47-2"><a href="results.html#cb47-2" tabindex="-1"></a>df_test_summ <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_test_summ, testr2_sds, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;model&quot;</span>,<span class="st">&quot;source&quot;</span>))</span>
<span id="cb47-3"><a href="results.html#cb47-3" tabindex="-1"></a>df_test_summ</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":["source"],"name":[2],"type":["fct"],"align":["left"]},{"label":["ME"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ME_CI_L"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["ME_CI_U"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["MAE"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["MAPE"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["RMSE"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["R2"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["R2_sd"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"day","2":"all","3":"-0.47","4":"-0.48","5":"-0.46","6":"1.70","7":"28.90","8":"2.35","9":"0.36","10":"0.0020410907"},{"1":"day","2":"ema","3":"-0.51","4":"-0.52","5":"-0.50","6":"1.69","7":"28.53","8":"2.35","9":"0.36","10":"0.0025531264"},{"1":"day","2":"epa","3":"-0.79","4":"-0.80","5":"-0.78","6":"2.27","7":"39.60","8":"2.95","9":"0.00","10":"0.0026947666"},{"1":"week","2":"all","3":"-1.10","4":"-1.15","5":"-1.05","6":"3.31","7":"63.81","8":"4.40","9":"0.18","10":"0.0119801838"},{"1":"week","2":"ema","3":"-0.92","4":"-0.97","5":"-0.88","6":"3.24","7":"64.00","8":"4.28","9":"0.20","10":"0.0111137193"},{"1":"week","2":"epa","3":"-1.28","4":"-1.33","5":"-1.23","6":"3.73","7":"79.52","8":"4.87","9":"0.00","10":"0.0009219665"},{"1":"week","2":"phq_lag1","3":"-0.32","4":"-0.35","5":"-0.28","6":"2.35","7":"44.86","8":"3.19","9":"0.54","10":"0.0011176160"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="results.html#cb48-1" tabindex="-1"></a>df_test_summ<span class="sc">$</span>set <span class="ot">=</span> <span class="st">&quot;test&quot;</span></span></code></pre></div>
</div>
<div id="full-results" class="section level3 active hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Full Results<a href="results.html#full-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="results.html#cb49-1" tabindex="-1"></a>df_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_val_summ, df_test_summ)</span>
<span id="cb49-2"><a href="results.html#cb49-2" tabindex="-1"></a>df_results <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="results.html#cb49-3" tabindex="-1"></a>  <span class="fu">arrange</span>(model, source, set) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="results.html#cb49-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">11</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">10</span>) </span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":["source"],"name":[2],"type":["fct"],"align":["left"]},{"label":["set"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ME"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["ME_CI_L"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ME_CI_U"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["MAE"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["MAPE"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["RMSE"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["R2"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["R2_sd"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"day","2":"ema","3":"cv","4":"-0.39","5":"-0.41","6":"-0.37","7":"1.61","8":"28.00","9":"2.24","10":"0.38","11":"0.0178631509"},{"1":"day","2":"ema","3":"test","4":"-0.51","5":"-0.52","6":"-0.50","7":"1.69","8":"28.53","9":"2.35","10":"0.36","11":"0.0025531264"},{"1":"day","2":"epa","3":"cv","4":"-0.65","5":"-0.67","6":"-0.63","7":"2.17","8":"38.96","9":"2.84","10":"0.01","11":"0.0060367772"},{"1":"day","2":"epa","3":"test","4":"-0.79","5":"-0.80","6":"-0.78","7":"2.27","8":"39.60","9":"2.95","10":"0.00","11":"0.0026947666"},{"1":"day","2":"all","3":"cv","4":"-0.36","5":"-0.37","6":"-0.34","7":"1.63","8":"28.45","9":"2.25","10":"0.38","11":"0.0181491710"},{"1":"day","2":"all","3":"test","4":"-0.47","5":"-0.48","6":"-0.46","7":"1.70","8":"28.90","9":"2.35","10":"0.36","11":"0.0020410907"},{"1":"day","2":"phq_lag1","3":"cv","4":"-0.94","5":"-0.96","6":"-0.92","7":"1.90","8":"30.89","9":"2.65","10":"0.20","11":"0.0447704390"},{"1":"week","2":"ema","3":"cv","4":"-0.58","5":"-0.67","6":"-0.48","7":"3.21","8":"70.32","9":"4.24","10":"0.22","11":"0.0438533295"},{"1":"week","2":"ema","3":"test","4":"-0.92","5":"-0.97","6":"-0.88","7":"3.24","8":"64.00","9":"4.28","10":"0.20","11":"0.0111137193"},{"1":"week","2":"epa","3":"cv","4":"-0.90","5":"-1.00","6":"-0.79","7":"3.66","8":"85.14","9":"4.80","10":"0.01","11":"0.0081129779"},{"1":"week","2":"epa","3":"test","4":"-1.28","5":"-1.33","6":"-1.23","7":"3.73","8":"79.52","9":"4.87","10":"0.00","11":"0.0009219665"},{"1":"week","2":"all","3":"cv","4":"-0.80","5":"-0.89","6":"-0.70","7":"3.22","8":"67.56","9":"4.32","10":"0.21","11":"0.0408866326"},{"1":"week","2":"all","3":"test","4":"-1.10","5":"-1.15","6":"-1.05","7":"3.31","8":"63.81","9":"4.40","10":"0.18","11":"0.0119801838"},{"1":"week","2":"phq_lag1","3":"cv","4":"-0.26","5":"-0.33","6":"-0.19","7":"2.27","8":"46.61","9":"3.12","10":"0.57","11":"0.0441502749"},{"1":"week","2":"phq_lag1","3":"test","4":"-0.32","5":"-0.35","6":"-0.28","7":"2.35","8":"44.86","9":"3.19","10":"0.54","11":"0.0011176160"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="idiographic-model-performance" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Idiographic Model Performance<a href="results.html#idiographic-model-performance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I also estimate the idiographic model performance, just doing R^2 here.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="results.html#cb50-1" tabindex="-1"></a>df_val<span class="sc">$</span>samp <span class="ot">&lt;-</span> <span class="st">&quot;10-fold Validation&quot;</span></span>
<span id="cb50-2"><a href="results.html#cb50-2" tabindex="-1"></a>df_test<span class="sc">$</span>samp <span class="ot">&lt;-</span> <span class="st">&quot;Test Data&quot;</span></span>
<span id="cb50-3"><a href="results.html#cb50-3" tabindex="-1"></a></span>
<span id="cb50-4"><a href="results.html#cb50-4" tabindex="-1"></a>df_idio <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_val, df_test)</span>
<span id="cb50-5"><a href="results.html#cb50-5" tabindex="-1"></a></span>
<span id="cb50-6"><a href="results.html#cb50-6" tabindex="-1"></a>df_idio <span class="ot">&lt;-</span> df_idio <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="results.html#cb50-7" tabindex="-1"></a>  <span class="fu">group_by</span>(sub_id, model, source, samp) <span class="sc">%&gt;%</span></span>
<span id="cb50-8"><a href="results.html#cb50-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">R2 =</span> <span class="fu">R2</span>(predicted, actual)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-9"><a href="results.html#cb50-9" tabindex="-1"></a>  <span class="fu">distinct</span>(sub_id, <span class="at">.keep_all=</span>T)</span></code></pre></div>
<pre><code>## Warning: There were 16 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `R2 = R2(predicted, actual)`.
## ℹ In group 5271: `sub_id = &quot;s665990513&quot;`, `model = &quot;week&quot;`, `source = ema`, `samp = &quot;Test Data&quot;`.
## Caused by warning in `cor()`:
## ! the standard deviation is zero
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 15 remaining warnings.</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="results.html#cb52-1" tabindex="-1"></a><span class="fu">ggplot</span>(df_idio, <span class="fu">aes</span>(<span class="at">x=</span>R2, <span class="at">fill=</span>samp)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="results.html#cb52-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by=</span><span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="results.html#cb52-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb52-4"><a href="results.html#cb52-4" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> source)</span></code></pre></div>
<pre><code>## Warning in geom_bar(breaks = seq(0, 1, by = 0.1)): Ignoring unknown parameters: `breaks`</code></pre>
<pre><code>## Warning: Removed 16 rows containing non-finite outside the scale range (`stat_count()`).</code></pre>
<p><img src="final_report_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="results.html#cb55-1" tabindex="-1"></a>df_idio_sum <span class="ot">&lt;-</span> Rmisc<span class="sc">::</span><span class="fu">summarySEwithin</span>(df_idio, <span class="at">measurevar =</span> <span class="st">&quot;R2&quot;</span>, <span class="at">withinvars =</span> <span class="fu">c</span>(<span class="st">&quot;model&quot;</span>, <span class="st">&quot;source&quot;</span>, <span class="st">&quot;samp&quot;</span>), <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>## Automatically converting the following non-factors to factors: model, samp</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="results.html#cb57-1" tabindex="-1"></a><span class="fu">ggplot</span>(df_idio_sum, <span class="fu">aes</span>(<span class="at">y=</span>R2, <span class="at">x=</span>source, <span class="at">fill=</span>samp, <span class="at">color=</span>samp)) <span class="sc">+</span> </span>
<span id="cb57-2"><a href="results.html#cb57-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, <span class="at">position=</span><span class="fu">position_dodge2</span>(), <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="results.html#cb57-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb57-4"><a href="results.html#cb57-4" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>R2<span class="sc">-</span>ci, <span class="at">ymax =</span> R2<span class="sc">+</span>ci), <span class="at">position =</span> <span class="fu">position_dodge2</span>()) <span class="sc">+</span></span>
<span id="cb57-5"><a href="results.html#cb57-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-6"><a href="results.html#cb57-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb57-7"><a href="results.html#cb57-7" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>.)</span></code></pre></div>
<pre><code>## No summary function supplied, defaulting to `mean_se()`</code></pre>
<pre><code>## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`</code></pre>
<p><img src="final_report_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
</div>
<div id="shap" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> SHAP<a href="results.html#shap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now I estimate the SHAP plots for feature contributions. I wrap this into a function that lets me plot a bit more easily and keep some visual consistency. The funciton will filter the data to reduce overhead memory usage, rank the SHAP values based on the absolute SHAP values, and then filter and plot the top 10 features. I do the data loading after setting-up the function to read all the SHAP values.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="results.html#cb60-1" tabindex="-1"></a><span class="co"># Plotting functions</span></span>
<span id="cb60-2"><a href="results.html#cb60-2" tabindex="-1"></a>shap_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(shap_values, <span class="at">models=</span><span class="st">&#39;week&#39;</span>, <span class="at">sources=</span><span class="st">&#39;ema&#39;</span>, <span class="at">feats =</span> <span class="dv">10</span>, <span class="at">x_range=</span><span class="fl">0.5</span>){</span>
<span id="cb60-3"><a href="results.html#cb60-3" tabindex="-1"></a>  </span>
<span id="cb60-4"><a href="results.html#cb60-4" tabindex="-1"></a>  <span class="co"># Filter and estimate abs values</span></span>
<span id="cb60-5"><a href="results.html#cb60-5" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> shap_values[model <span class="sc">==</span> models <span class="sc">&amp;</span> source <span class="sc">==</span> sources]</span>
<span id="cb60-6"><a href="results.html#cb60-6" tabindex="-1"></a>  df_temp[, shap_mean <span class="sc">:=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shap_fold_avg)), by <span class="ot">=</span> feature]</span>
<span id="cb60-7"><a href="results.html#cb60-7" tabindex="-1"></a>  df_temp[, shap_order <span class="sc">:=</span> <span class="fu">frank</span>(<span class="sc">-</span><span class="fu">abs</span>(shap_mean), <span class="at">ties.method =</span> <span class="st">&quot;dense&quot;</span>)]</span>
<span id="cb60-8"><a href="results.html#cb60-8" tabindex="-1"></a>  df_temp[, shap_order <span class="sc">:=</span> shap_order<span class="dv">-1</span>]</span>
<span id="cb60-9"><a href="results.html#cb60-9" tabindex="-1"></a>  </span>
<span id="cb60-10"><a href="results.html#cb60-10" tabindex="-1"></a>  <span class="co"># Keep top features</span></span>
<span id="cb60-11"><a href="results.html#cb60-11" tabindex="-1"></a>  df_temp_top <span class="ot">&lt;-</span> df_temp[shap_order <span class="sc">&lt;=</span> feats<span class="dv">-1</span>]</span>
<span id="cb60-12"><a href="results.html#cb60-12" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(df_temp_top<span class="sc">$</span>feature_labs)</span>
<span id="cb60-13"><a href="results.html#cb60-13" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">fct_rev</span>(<span class="fu">factor</span>(df_temp_top<span class="sc">$</span>feature_labs,</span>
<span id="cb60-14"><a href="results.html#cb60-14" tabindex="-1"></a>                                     <span class="at">levels =</span> <span class="fu">unique</span>(df_temp_top[<span class="fu">order</span>(shap_order)]<span class="sc">$</span>feature_labs)))</span>
<span id="cb60-15"><a href="results.html#cb60-15" tabindex="-1"></a>  </span>
<span id="cb60-16"><a href="results.html#cb60-16" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb60-17"><a href="results.html#cb60-17" tabindex="-1"></a>  plot <span class="ot">=</span> <span class="fu">ggplot</span>(df_temp_top, <span class="fu">aes</span>(<span class="at">x=</span>shap_fold_avg, <span class="at">y =</span> feature_labs)) <span class="sc">+</span> </span>
<span id="cb60-18"><a href="results.html#cb60-18" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb60-19"><a href="results.html#cb60-19" tabindex="-1"></a>    <span class="fu">geom_quasirandom</span>(<span class="fu">aes</span>(<span class="at">color =</span> shap_fold_avg), <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb60-20"><a href="results.html#cb60-20" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>( <span class="at">limits =</span> <span class="fu">levels</span>(df_temp_top<span class="sc">$</span>feature_labs),</span>
<span id="cb60-21"><a href="results.html#cb60-21" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">levels</span>(df_temp_top<span class="sc">$</span>feature_labs)) <span class="sc">+</span></span>
<span id="cb60-22"><a href="results.html#cb60-22" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span><span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb60-23"><a href="results.html#cb60-23" tabindex="-1"></a>    <span class="fu">scale_color_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">mid=</span><span class="st">&#39;yellow&#39;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb60-24"><a href="results.html#cb60-24" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> <span class="st">&quot;SHAP Values&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-25"><a href="results.html#cb60-25" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb60-26"><a href="results.html#cb60-26" tabindex="-1"></a>    <span class="fu">theme</span>( <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">7</span>),</span>
<span id="cb60-27"><a href="results.html#cb60-27" tabindex="-1"></a>           <span class="at">legend.position=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb60-28"><a href="results.html#cb60-28" tabindex="-1"></a>           <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;SegoeSymb&quot;</span>, <span class="at">size=</span><span class="fl">6.5</span>, <span class="at">angle=</span><span class="dv">45</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">l=</span><span class="dv">25</span>)),</span>
<span id="cb60-29"><a href="results.html#cb60-29" tabindex="-1"></a>           <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t=</span><span class="dv">10</span>, <span class="at">b=</span><span class="dv">10</span>)), </span>
<span id="cb60-30"><a href="results.html#cb60-30" tabindex="-1"></a>           <span class="at">axis.text.x =</span> <span class="fu">element_text</span>( <span class="at">size=</span><span class="fl">6.5</span>)) <span class="sc">+</span></span>
<span id="cb60-31"><a href="results.html#cb60-31" tabindex="-1"></a>    </span>
<span id="cb60-32"><a href="results.html#cb60-32" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span>x_range,x_range)) </span>
<span id="cb60-33"><a href="results.html#cb60-33" tabindex="-1"></a>    </span>
<span id="cb60-34"><a href="results.html#cb60-34" tabindex="-1"></a>  </span>
<span id="cb60-35"><a href="results.html#cb60-35" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb60-36"><a href="results.html#cb60-36" tabindex="-1"></a>}</span>
<span id="cb60-37"><a href="results.html#cb60-37" tabindex="-1"></a></span>
<span id="cb60-38"><a href="results.html#cb60-38" tabindex="-1"></a></span>
<span id="cb60-39"><a href="results.html#cb60-39" tabindex="-1"></a>shap_plot_ts<span class="ot">&lt;-</span> <span class="cf">function</span>(shap_values, models, sources){</span>
<span id="cb60-40"><a href="results.html#cb60-40" tabindex="-1"></a>  </span>
<span id="cb60-41"><a href="results.html#cb60-41" tabindex="-1"></a>  <span class="co"># Filter and estimate abs values</span></span>
<span id="cb60-42"><a href="results.html#cb60-42" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> shap_values[model <span class="sc">==</span> models <span class="sc">&amp;</span> source <span class="sc">==</span> sources]</span>
<span id="cb60-43"><a href="results.html#cb60-43" tabindex="-1"></a>  df_temp[, shap_mean <span class="sc">:=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(shap_fold_avg)), by <span class="ot">=</span> feature]</span>
<span id="cb60-44"><a href="results.html#cb60-44" tabindex="-1"></a>  df_temp[, shap_order <span class="sc">:=</span> <span class="fu">frank</span>(<span class="sc">-</span><span class="fu">abs</span>(shap_mean), <span class="at">ties.method =</span> <span class="st">&quot;dense&quot;</span>)]</span>
<span id="cb60-45"><a href="results.html#cb60-45" tabindex="-1"></a>  df_temp[,step <span class="sc">:=</span> step]</span>
<span id="cb60-46"><a href="results.html#cb60-46" tabindex="-1"></a>  </span>
<span id="cb60-47"><a href="results.html#cb60-47" tabindex="-1"></a>  <span class="co"># Keep top features</span></span>
<span id="cb60-48"><a href="results.html#cb60-48" tabindex="-1"></a>  df_temp_top <span class="ot">&lt;-</span> df_temp[shap_order <span class="sc">&lt;=</span> <span class="dv">10</span>]</span>
<span id="cb60-49"><a href="results.html#cb60-49" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(df_temp_top<span class="sc">$</span>feature_labs)</span>
<span id="cb60-50"><a href="results.html#cb60-50" tabindex="-1"></a>  df_temp_top<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_temp_top<span class="sc">$</span>feature_labs,</span>
<span id="cb60-51"><a href="results.html#cb60-51" tabindex="-1"></a>                                     <span class="at">levels =</span> <span class="fu">unique</span>(df_temp_top[<span class="fu">order</span>(shap_order)]<span class="sc">$</span>feature_labs))</span>
<span id="cb60-52"><a href="results.html#cb60-52" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb60-53"><a href="results.html#cb60-53" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_temp_top, <span class="fu">aes</span>(<span class="at">x=</span>step, <span class="at">y =</span> shap_fold_avg)) <span class="sc">+</span> </span>
<span id="cb60-54"><a href="results.html#cb60-54" tabindex="-1"></a>     <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb60-55"><a href="results.html#cb60-55" tabindex="-1"></a>     <span class="fu">geom_quasirandom</span>(<span class="fu">aes</span>(<span class="at">color =</span> shap_fold_avg), <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb60-56"><a href="results.html#cb60-56" tabindex="-1"></a>      <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb60-57"><a href="results.html#cb60-57" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;SHAP Values&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Time Steps&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-58"><a href="results.html#cb60-58" tabindex="-1"></a>     <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb60-59"><a href="results.html#cb60-59" tabindex="-1"></a>     <span class="fu">theme</span>( <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb60-60"><a href="results.html#cb60-60" tabindex="-1"></a>            <span class="at">legend.position=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb60-61"><a href="results.html#cb60-61" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>),</span>
<span id="cb60-62"><a href="results.html#cb60-62" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">21</span>),</span>
<span id="cb60-63"><a href="results.html#cb60-63" tabindex="-1"></a>            <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;SegoeSymb&quot;</span>, <span class="at">size=</span><span class="dv">21</span>)) <span class="sc">+</span></span>
<span id="cb60-64"><a href="results.html#cb60-64" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(feature_labs<span class="sc">~</span>., <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb60-65"><a href="results.html#cb60-65" tabindex="-1"></a>  </span>
<span id="cb60-66"><a href="results.html#cb60-66" tabindex="-1"></a>  <span class="fu">return</span>(plot) </span>
<span id="cb60-67"><a href="results.html#cb60-67" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="results.html#cb61-1" tabindex="-1"></a><span class="co"># Read in the Python Estimated SHAP values</span></span>
<span id="cb61-2"><a href="results.html#cb61-2" tabindex="-1"></a>shap_values <span class="ot">=</span> <span class="fu">Sys.glob</span>(<span class="st">&quot;C:/Users/rayya/Nextcloud/FSW_WARN-D (Projectfolder)/group/raytut/projects/prediction_nomothetic/results/shap_values_*.csv&quot;</span>)</span>
<span id="cb61-3"><a href="results.html#cb61-3" tabindex="-1"></a>shap_values <span class="ot">=</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(shap_values, fread), <span class="at">fill=</span>T)</span>
<span id="cb61-4"><a href="results.html#cb61-4" tabindex="-1"></a><span class="fu">setDT</span>(shap_values)</span>
<span id="cb61-5"><a href="results.html#cb61-5" tabindex="-1"></a></span>
<span id="cb61-6"><a href="results.html#cb61-6" tabindex="-1"></a><span class="co"># Convert to a long dataframe</span></span>
<span id="cb61-7"><a href="results.html#cb61-7" tabindex="-1"></a>shap_values <span class="ot">&lt;-</span> <span class="fu">melt</span>(shap_values,</span>
<span id="cb61-8"><a href="results.html#cb61-8" tabindex="-1"></a>                    <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;step&quot;</span>, <span class="st">&quot;fold&quot;</span>, <span class="st">&quot;source&quot;</span>, <span class="st">&quot;model&quot;</span>), </span>
<span id="cb61-9"><a href="results.html#cb61-9" tabindex="-1"></a>                    <span class="at">variable.name =</span> <span class="st">&quot;feature&quot;</span>, <span class="at">value.name =</span> <span class="st">&quot;shap&quot;</span>)</span>
<span id="cb61-10"><a href="results.html#cb61-10" tabindex="-1"></a>  </span>
<span id="cb61-11"><a href="results.html#cb61-11" tabindex="-1"></a><span class="co"># Average across folds</span></span>
<span id="cb61-12"><a href="results.html#cb61-12" tabindex="-1"></a>shap_values[, shap_fold_avg <span class="sc">:=</span> <span class="fu">mean</span>(shap, <span class="at">na.rm=</span>T), by <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;sample&#39;</span>, <span class="st">&#39;step&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;feature&#39;</span>)]</span>
<span id="cb61-13"><a href="results.html#cb61-13" tabindex="-1"></a>shap_values[, fold <span class="sc">:=</span> <span class="cn">NULL</span>]</span>
<span id="cb61-14"><a href="results.html#cb61-14" tabindex="-1"></a>shap_values[, shap <span class="sc">:=</span> <span class="cn">NULL</span>]</span>
<span id="cb61-15"><a href="results.html#cb61-15" tabindex="-1"></a>shap_values <span class="ot">&lt;-</span> <span class="fu">unique</span>(shap_values)</span>
<span id="cb61-16"><a href="results.html#cb61-16" tabindex="-1"></a></span>
<span id="cb61-17"><a href="results.html#cb61-17" tabindex="-1"></a><span class="co"># Make prettier labels</span></span>
<span id="cb61-18"><a href="results.html#cb61-18" tabindex="-1"></a>variable_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-19"><a href="results.html#cb61-19" tabindex="-1"></a>  <span class="st">&quot;sleep_qual_m&quot;</span>, <span class="st">&quot;sleep_rest_m&quot;</span>, <span class="st">&quot;outlook_m&quot;</span>,</span>
<span id="cb61-20"><a href="results.html#cb61-20" tabindex="-1"></a>  <span class="st">&quot;overwhelm_d&quot;</span>, <span class="st">&quot;motivated_d&quot;</span>, <span class="st">&quot;stressed_d&quot;</span>, <span class="st">&quot;ruminate_d&quot;</span>, <span class="st">&quot;tired_d&quot;</span>, <span class="st">&quot;nervous_d&quot;</span>, <span class="st">&quot;sad_d&quot;</span>, <span class="st">&quot;relaxed_d&quot;</span>, <span class="st">&quot;cheerful_d&quot;</span>, <span class="st">&quot;irritable_d&quot;</span>,</span>
<span id="cb61-21"><a href="results.html#cb61-21" tabindex="-1"></a>  <span class="st">&quot;activity_enjoy_d&quot;</span>, <span class="st">&quot;offline_enjoy_d&quot;</span>, <span class="st">&quot;online_enjoy_d&quot;</span>, </span>
<span id="cb61-22"><a href="results.html#cb61-22" tabindex="-1"></a>  <span class="st">&quot;discomfort_e&quot;</span>, <span class="st">&quot;emo_reg_e&quot;</span>, <span class="st">&quot;useful_e&quot;</span>, <span class="st">&quot;neg_exp_e&quot;</span>, <span class="st">&quot;pos_exp_e&quot;</span>,</span>
<span id="cb61-23"><a href="results.html#cb61-23" tabindex="-1"></a>  <span class="st">&quot;neg_exp_cat_e_1&quot;</span>, <span class="st">&quot;neg_exp_cat_e_2&quot;</span>, <span class="st">&quot;neg_exp_cat_e_3&quot;</span>, <span class="st">&quot;neg_exp_cat_e_10&quot;</span>,</span>
<span id="cb61-24"><a href="results.html#cb61-24" tabindex="-1"></a>  <span class="st">&quot;neg_exp_cat_e_4&quot;</span>, <span class="st">&quot;neg_exp_cat_e_5&quot;</span>, <span class="st">&quot;neg_exp_cat_e_6&quot;</span>, <span class="st">&quot;neg_exp_cat_e_11&quot;</span>,</span>
<span id="cb61-25"><a href="results.html#cb61-25" tabindex="-1"></a>  <span class="st">&quot;neg_exp_cat_e_7&quot;</span>, <span class="st">&quot;neg_exp_cat_e_8&quot;</span>, <span class="st">&quot;neg_exp_cat_e_12&quot;</span>, </span>
<span id="cb61-26"><a href="results.html#cb61-26" tabindex="-1"></a>  <span class="st">&quot;pos_exp_cat_e_1&quot;</span>, <span class="st">&quot;pos_exp_cat_e_2&quot;</span>, <span class="st">&quot;pos_exp_cat_e_3&quot;</span>, <span class="st">&quot;pos_exp_cat_e_10&quot;</span>,</span>
<span id="cb61-27"><a href="results.html#cb61-27" tabindex="-1"></a>  <span class="st">&quot;pos_exp_cat_e_4&quot;</span>, <span class="st">&quot;pos_exp_cat_e_5&quot;</span>, <span class="st">&quot;pos_exp_cat_e_6&quot;</span>, <span class="st">&quot;pos_exp_cat_e_11&quot;</span>,</span>
<span id="cb61-28"><a href="results.html#cb61-28" tabindex="-1"></a>  <span class="st">&quot;pos_exp_cat_e_7&quot;</span>, <span class="st">&quot;pos_exp_cat_e_8&quot;</span>, <span class="st">&quot;pos_exp_cat_e_12&quot;</span>,</span>
<span id="cb61-29"><a href="results.html#cb61-29" tabindex="-1"></a>  <span class="st">&quot;substance_e_1&quot;</span>, <span class="st">&quot;substance_e_2&quot;</span>, <span class="st">&quot;substance_e_3&quot;</span>, <span class="st">&quot;substance_e_4&quot;</span>, <span class="st">&quot;substance_e_5&quot;</span>, <span class="st">&quot;substance_e_6&quot;</span>, </span>
<span id="cb61-30"><a href="results.html#cb61-30" tabindex="-1"></a>  <span class="st">&quot;substance_e_7&quot;</span>, <span class="st">&quot;substance_e_8&quot;</span>, <span class="st">&quot;substance_e_9&quot;</span>,</span>
<span id="cb61-31"><a href="results.html#cb61-31" tabindex="-1"></a>  <span class="st">&quot;hr_mean&quot;</span>, <span class="st">&quot;hr_min&quot;</span>, <span class="st">&quot;hr_max&quot;</span>, <span class="st">&quot;hr_sd&quot;</span>, </span>
<span id="cb61-32"><a href="results.html#cb61-32" tabindex="-1"></a>  <span class="st">&quot;stress_mean&quot;</span>, <span class="st">&quot;stress_sd&quot;</span>, <span class="st">&quot;stress_min&quot;</span>, <span class="st">&quot;stress_max&quot;</span>,</span>
<span id="cb61-33"><a href="results.html#cb61-33" tabindex="-1"></a>  <span class="st">&quot;intraday_activity_cals&quot;</span>, <span class="st">&quot;intraday_steps&quot;</span>, <span class="st">&quot;intraday_active_seconds&quot;</span>, </span>
<span id="cb61-34"><a href="results.html#cb61-34" tabindex="-1"></a>  <span class="st">&quot;intraday_met_value&quot;</span>, <span class="st">&quot;intraday_intensity_mean&quot;</span>, <span class="st">&quot;intraday_intensity_max&quot;</span>, </span>
<span id="cb61-35"><a href="results.html#cb61-35" tabindex="-1"></a>  <span class="st">&quot;body_bat_mean&quot;</span>, <span class="st">&quot;body_bat_sd&quot;</span>, <span class="st">&quot;body_bat_min&quot;</span>, <span class="st">&quot;body_bat_max&quot;</span>, </span>
<span id="cb61-36"><a href="results.html#cb61-36" tabindex="-1"></a>  <span class="st">&quot;sleep_hr_mean&quot;</span>, <span class="st">&quot;sleep_hr_median&quot;</span>, <span class="st">&quot;sleep_hr_skew&quot;</span>, <span class="st">&quot;sleep_hr_kurt&quot;</span>, </span>
<span id="cb61-37"><a href="results.html#cb61-37" tabindex="-1"></a>  <span class="st">&quot;sleep_hr_min&quot;</span>, <span class="st">&quot;sleep_hr_max&quot;</span>, <span class="st">&quot;sleep_hr_sd&quot;</span>, <span class="st">&quot;sleep_start&quot;</span>, </span>
<span id="cb61-38"><a href="results.html#cb61-38" tabindex="-1"></a>  <span class="st">&quot;sleep_end&quot;</span>, <span class="st">&quot;sleep_dur_tot_s&quot;</span></span>
<span id="cb61-39"><a href="results.html#cb61-39" tabindex="-1"></a>  )</span>
<span id="cb61-40"><a href="results.html#cb61-40" tabindex="-1"></a></span>
<span id="cb61-41"><a href="results.html#cb61-41" tabindex="-1"></a><span class="co"># Have to them one line at a time unfortsh</span></span>
<span id="cb61-42"><a href="results.html#cb61-42" tabindex="-1"></a>variable_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-43"><a href="results.html#cb61-43" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep Quality&quot;</span>,<span class="st">&quot;🛏Rested&quot;</span>, <span class="st">&quot;🛏Outlook&quot;</span>,</span>
<span id="cb61-44"><a href="results.html#cb61-44" tabindex="-1"></a>  <span class="st">&quot;☀Overwhelm&quot;</span>, <span class="st">&quot;☀Motivated&quot;</span>, <span class="st">&quot;☀Stressed&quot;</span>, <span class="st">&quot;☀Ruminate&quot;</span>, <span class="st">&quot;☀Tired&quot;</span>,<span class="st">&quot;☀Nervous&quot;</span>, </span>
<span id="cb61-45"><a href="results.html#cb61-45" tabindex="-1"></a>  <span class="st">&quot;☀Sad&quot;</span>, <span class="st">&quot;☀Relaxed&quot;</span>, <span class="st">&quot;☀Cheerful&quot;</span>, <span class="st">&quot;☀Irritable&quot;</span>, <span class="st">&quot;☀Activity&quot;</span>, <span class="st">&quot;☀Social (offline)&quot;</span>, <span class="st">&quot;☀Social (online)&quot;</span>, </span>
<span id="cb61-46"><a href="results.html#cb61-46" tabindex="-1"></a>  <span class="st">&quot;🌙Discomfort&quot;</span>, <span class="st">&quot;🌙Emo. Regulation&quot;</span>, <span class="st">&quot;🌙Useful&quot;</span>,</span>
<span id="cb61-47"><a href="results.html#cb61-47" tabindex="-1"></a>  <span class="st">&quot;🌙Neg. Experience&quot;</span>, <span class="st">&quot;🌙Pos. Experience&quot;</span>, <span class="st">&quot;🌙Neg. Wellbeing (Phys)&quot;</span>,</span>
<span id="cb61-48"><a href="results.html#cb61-48" tabindex="-1"></a>  <span class="st">&quot;🌙Neg. Wellbeing (Ment)&quot;</span>, <span class="st">&quot;🌙Neg. Finances&quot;</span>, <span class="st">&quot;🌙Neg. Education/Work&quot;</span>,</span>
<span id="cb61-49"><a href="results.html#cb61-49" tabindex="-1"></a>  <span class="st">&quot;🌙Neg. Home&quot;</span>,  <span class="st">&quot;🌙Neg. Leisure&quot;</span>, <span class="st">&quot;🌙Neg. Love Life&quot;</span>,</span>
<span id="cb61-50"><a href="results.html#cb61-50" tabindex="-1"></a>  <span class="st">&quot;🌙Neg. Social Life&quot;</span>, <span class="st">&quot;🌙Neg. Relationships (Family)&quot;</span>, <span class="st">&quot;🌙Neg. Experiences (Friends/Family)&quot;</span>,</span>
<span id="cb61-51"><a href="results.html#cb61-51" tabindex="-1"></a>  <span class="st">&quot;🌙Neg. Society/Politics&quot;</span>, </span>
<span id="cb61-52"><a href="results.html#cb61-52" tabindex="-1"></a>  <span class="st">&quot;🌙Pos. Wellbeing (Phys)&quot;</span>, <span class="st">&quot;🌙Pos. Wellbeing (Ment)&quot;</span>, <span class="st">&quot;🌙Neg. Finances&quot;</span>, </span>
<span id="cb61-53"><a href="results.html#cb61-53" tabindex="-1"></a>  <span class="st">&quot;🌙Pos. Education/Work&quot;</span>, <span class="st">&quot;🌙Pos. Home&quot;</span>, <span class="st">&quot;🌙Pos. Leisure&quot;</span>, <span class="st">&quot;🌙Pos. Love Life&quot;</span>, <span class="st">&quot;🌙Pos. Social Life&quot;</span>,</span>
<span id="cb61-54"><a href="results.html#cb61-54" tabindex="-1"></a>  <span class="st">&quot;🌙Pos. Relationships (Family)&quot;</span>, <span class="st">&quot;🌙Pos. Experiences (Friends/Family)&quot;</span>, <span class="st">&quot;🌙Pos. Society/Politics&quot;</span>,</span>
<span id="cb61-55"><a href="results.html#cb61-55" tabindex="-1"></a>  <span class="st">&quot;🌙Caffeine&quot;</span>, <span class="st">&quot;🌙Tobacco&quot;</span>, <span class="st">&quot;🌙Alcohol&quot;</span>, <span class="st">&quot;🌙Cannabis&quot;</span>, </span>
<span id="cb61-56"><a href="results.html#cb61-56" tabindex="-1"></a>  <span class="st">&quot;🌙Ecstasy&quot;</span>, <span class="st">&quot;🌙Amphetamines&quot;</span>, <span class="st">&quot;🌙Cocaine&quot;</span>, <span class="st">&quot;🌙 Other Subs.&quot;</span>, <span class="st">&quot;🌙No Subs.&quot;</span>, </span>
<span id="cb61-57"><a href="results.html#cb61-57" tabindex="-1"></a>  <span class="st">&quot;️☀HR Mean⌚&quot;</span>,</span>
<span id="cb61-58"><a href="results.html#cb61-58" tabindex="-1"></a>  <span class="st">&quot;☀HR Min⌚&quot;</span>,</span>
<span id="cb61-59"><a href="results.html#cb61-59" tabindex="-1"></a>  <span class="st">&quot;☀HR Max⌚️&quot;</span>, </span>
<span id="cb61-60"><a href="results.html#cb61-60" tabindex="-1"></a>  <span class="st">&quot;☀HR SD⌚️&quot;</span>, </span>
<span id="cb61-61"><a href="results.html#cb61-61" tabindex="-1"></a>  <span class="st">&quot;☀Stress Mean⌚&quot;</span>,</span>
<span id="cb61-62"><a href="results.html#cb61-62" tabindex="-1"></a>  <span class="st">&quot;☀Stress SD⌚&quot;</span>, <span class="st">&quot;☀Stress Min⌚&quot;</span>, <span class="st">&quot;☀Stress Max⌚️&quot;</span>,  </span>
<span id="cb61-63"><a href="results.html#cb61-63" tabindex="-1"></a>  <span class="st">&quot;☀Calories⌚&quot;</span>, <span class="st">&quot;☀Steps⌚&quot;</span>, <span class="st">&quot;☀Active Time (s)⌚&quot;</span>, </span>
<span id="cb61-64"><a href="results.html#cb61-64" tabindex="-1"></a>  <span class="st">&quot;☀MET Value⌚&quot;</span>,  <span class="st">&quot;☀Activity Intensity⌚&quot;</span>, <span class="st">&quot;☀Maximum Intensity⌚&quot;</span>, </span>
<span id="cb61-65"><a href="results.html#cb61-65" tabindex="-1"></a>  <span class="st">&quot;☀Body Bat. Mean⌚️&quot;</span>, <span class="st">&quot;☀Body Bat. SD⌚&quot;</span>, <span class="st">&quot;☀Body Bat. Min⌚&quot;</span>, <span class="st">&quot;☀Body Bat. Max⌚&quot;</span>, </span>
<span id="cb61-66"><a href="results.html#cb61-66" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep HR Mean⌚️&quot;</span>, </span>
<span id="cb61-67"><a href="results.html#cb61-67" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep HR Median⌚️&quot;</span>, </span>
<span id="cb61-68"><a href="results.html#cb61-68" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep HR Skew⌚️&quot;</span>, </span>
<span id="cb61-69"><a href="results.html#cb61-69" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep HR Kurtosis⌚️&quot;</span>, </span>
<span id="cb61-70"><a href="results.html#cb61-70" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep HR Min⌚️&quot;</span>, </span>
<span id="cb61-71"><a href="results.html#cb61-71" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep HR Max⌚️&quot;</span>, </span>
<span id="cb61-72"><a href="results.html#cb61-72" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep HR SD⌚️&quot;</span>, </span>
<span id="cb61-73"><a href="results.html#cb61-73" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep Start⌚️&quot;</span>, </span>
<span id="cb61-74"><a href="results.html#cb61-74" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep End⌚&quot;</span>, </span>
<span id="cb61-75"><a href="results.html#cb61-75" tabindex="-1"></a>  <span class="st">&quot;🛏Sleep Duration⌚️&quot;</span>) </span>
<span id="cb61-76"><a href="results.html#cb61-76" tabindex="-1"></a></span>
<span id="cb61-77"><a href="results.html#cb61-77" tabindex="-1"></a><span class="co"># Make a label column for parsing</span></span>
<span id="cb61-78"><a href="results.html#cb61-78" tabindex="-1"></a>shap_values<span class="sc">$</span>feature_labs <span class="ot">&lt;-</span> <span class="fu">factor</span>(shap_values<span class="sc">$</span>feature, </span>
<span id="cb61-79"><a href="results.html#cb61-79" tabindex="-1"></a>                                   <span class="at">levels=</span>variable_codes,</span>
<span id="cb61-80"><a href="results.html#cb61-80" tabindex="-1"></a>                                   <span class="at">labels=</span>variable_labels)</span></code></pre></div>
<div id="top-10-daily" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Top 10 Daily<a href="results.html#top-10-daily" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="results.html#cb62-1" tabindex="-1"></a><span class="co"># Set up the three plots</span></span>
<span id="cb62-2"><a href="results.html#cb62-2" tabindex="-1"></a>plot_d1 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;ema&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb62-3"><a href="results.html#cb62-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartphone Self-Report (EMA)&quot;</span>)</span>
<span id="cb62-4"><a href="results.html#cb62-4" tabindex="-1"></a>plot_d2 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;epa&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span>   </span>
<span id="cb62-5"><a href="results.html#cb62-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartwatch Passive Sensing&quot;</span>) </span>
<span id="cb62-6"><a href="results.html#cb62-6" tabindex="-1"></a>plot_d3 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;all&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span>   </span>
<span id="cb62-7"><a href="results.html#cb62-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Combined Model&quot;</span>) </span>
<span id="cb62-8"><a href="results.html#cb62-8" tabindex="-1"></a></span>
<span id="cb62-9"><a href="results.html#cb62-9" tabindex="-1"></a><span class="co"># Arrange them and save em</span></span>
<span id="cb62-10"><a href="results.html#cb62-10" tabindex="-1"></a>day_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(plot_d1, plot_d2, plot_d3, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`</code></pre>
<p><img src="final_report_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="results.html#cb64-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_1_daily_mods.svg&quot;</span>, <span class="at">plot=</span>day_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb64-2"><a href="results.html#cb64-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_1_daily_mods.png&quot;</span>, <span class="at">plot=</span>day_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
<p>Then we check the SHAP values per timestep.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="results.html#cb65-1" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb65-2"><a href="results.html#cb65-2" tabindex="-1"></a>plot_d_3_ts <span class="ot">&lt;-</span> <span class="fu">shap_plot_ts</span>(shap_values, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;all&quot;</span>)</span>
<span id="cb65-3"><a href="results.html#cb65-3" tabindex="-1"></a>plot_d_3_ts</span></code></pre></div>
<p><img src="final_report_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="results.html#cb66-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_daily_ts_shap.svg&quot;</span>, plot_d_3_ts, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>,<span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb66-2"><a href="results.html#cb66-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_daily_ts_shap.png&quot;</span>, plot_d_3_ts, <span class="at">dpi=</span><span class="dv">900</span>,<span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>,<span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
</div>
<div id="top-10-weekly" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Top 10 Weekly<a href="results.html#top-10-weekly" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Check the overall SHAP values</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="results.html#cb67-1" tabindex="-1"></a><span class="co"># Set up the three plots</span></span>
<span id="cb67-2"><a href="results.html#cb67-2" tabindex="-1"></a>plot_w1 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;ema&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb67-3"><a href="results.html#cb67-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartphone Self-Report (EMA)&quot;</span>)</span>
<span id="cb67-4"><a href="results.html#cb67-4" tabindex="-1"></a>plot_w2 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;epa&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb67-5"><a href="results.html#cb67-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Smartwatch Passive Sensing&quot;</span>) </span>
<span id="cb67-6"><a href="results.html#cb67-6" tabindex="-1"></a>plot_w3 <span class="ot">&lt;-</span> <span class="fu">shap_plot</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;all&quot;</span>, <span class="dv">10</span>, <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb67-7"><a href="results.html#cb67-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Combined Model&quot;</span>) </span>
<span id="cb67-8"><a href="results.html#cb67-8" tabindex="-1"></a></span>
<span id="cb67-9"><a href="results.html#cb67-9" tabindex="-1"></a></span>
<span id="cb67-10"><a href="results.html#cb67-10" tabindex="-1"></a><span class="co"># Arrange em and save em</span></span>
<span id="cb67-11"><a href="results.html#cb67-11" tabindex="-1"></a>week_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(plot_w1, plot_w2, plot_w3, <span class="at">ncol =</span> <span class="dv">3</span>) </span></code></pre></div>
<pre><code>## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`
## Orientation inferred to be along y-axis; override with `position_quasirandom(orientation = &#39;x&#39;)`</code></pre>
<p><img src="final_report_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="results.html#cb69-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_2_weekly_mods.svg&quot;</span>, week_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb69-2"><a href="results.html#cb69-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/figure_2_weekly_mods.png&quot;</span>, week_plot, <span class="at">dpi=</span><span class="dv">600</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">12</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
<p>Now check the SHAP Values per timestep.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="results.html#cb70-1" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb70-2"><a href="results.html#cb70-2" tabindex="-1"></a>plot_w_3_ts <span class="ot">&lt;-</span> <span class="fu">shap_plot_ts</span>(shap_values, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;all&quot;</span>)</span>
<span id="cb70-3"><a href="results.html#cb70-3" tabindex="-1"></a>plot_w_3_ts</span></code></pre></div>
<p><img src="final_report_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="results.html#cb71-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_weekly_ts_shap.svg&quot;</span>, plot_w_3_ts, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span>
<span id="cb71-2"><a href="results.html#cb71-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_weekly_ts_shap.png&quot;</span>, plot_w_3_ts, <span class="at">dpi=</span><span class="dv">900</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">14</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
</div>
</div>
<div id="supp-analysis" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Supp Analysis<a href="results.html#supp-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="phq-9-autoregressive-model" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> PHQ-9 Autoregressive Model<a href="results.html#phq-9-autoregressive-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We investigate the PHQ-9 model performance visually to see whats going on in the weekly models.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="results.html#cb72-1" tabindex="-1"></a>df_val_phq_lead <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="results.html#cb72-2" tabindex="-1"></a>  <span class="fu">filter</span>( model <span class="sc">==</span> <span class="st">&#39;week&#39;</span> <span class="sc">&amp;</span> source <span class="sc">==</span> <span class="st">&quot;phq_lag1&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="results.html#cb72-3" tabindex="-1"></a>  <span class="fu">group_by</span>(sub_id, fold) <span class="sc">%&gt;%</span> </span>
<span id="cb72-4"><a href="results.html#cb72-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phq_mean =</span> <span class="fu">mean</span>(actual, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-5"><a href="results.html#cb72-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_lead =</span> <span class="fu">lead</span>(predicted,<span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="results.html#cb72-6" tabindex="-1"></a>  <span class="fu">select</span>(sub_id, model,n, source, actual, predicted_lead, phq_mean) <span class="sc">%&gt;%</span></span>
<span id="cb72-7"><a href="results.html#cb72-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">predicted =</span> predicted_lead) <span class="sc">%&gt;%</span></span>
<span id="cb72-8"><a href="results.html#cb72-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">&quot;phq_lead&quot;</span>)</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `fold`</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="results.html#cb74-1" tabindex="-1"></a>df_val_phq_combi <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="results.html#cb74-2" tabindex="-1"></a>  <span class="fu">filter</span>( model <span class="sc">==</span> <span class="st">&#39;week&#39;</span> <span class="sc">&amp;</span> (source <span class="sc">==</span> <span class="st">&quot;all&quot;</span> <span class="sc">|</span> source <span class="sc">==</span> <span class="st">&quot;phq_lag1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-3"><a href="results.html#cb74-3" tabindex="-1"></a>  <span class="fu">group_by</span>(sub_id, fold) <span class="sc">%&gt;%</span> </span>
<span id="cb74-4"><a href="results.html#cb74-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phq_mean =</span> <span class="fu">mean</span>(actual, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="results.html#cb74-5" tabindex="-1"></a>  <span class="fu">select</span>(sub_id, model, n, source, actual, predicted, phq_mean)</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `fold`</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="results.html#cb76-1" tabindex="-1"></a>df_val_phq_combi <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_val_phq_combi, df_val_phq_lead)</span>
<span id="cb76-2"><a href="results.html#cb76-2" tabindex="-1"></a>df_val_phq_combi <span class="ot">&lt;-</span> df_val_phq_combi <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="results.html#cb76-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="results.html#cb76-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(predicted, actual), <span class="at">values_to =</span> <span class="st">&quot;phq&quot;</span>, <span class="at">names_to =</span> <span class="st">&quot;score&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-5"><a href="results.html#cb76-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictors =</span> <span class="fu">factor</span>(source, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;all&quot;</span>, <span class="st">&quot;phq_lag1&quot;</span>, <span class="st">&quot;phq_lead&quot;</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;Lagged PHQ&quot;</span>, <span class="st">&#39;&quot;Unlagged&quot; PHQ&#39;</span>)),</span>
<span id="cb76-6"><a href="results.html#cb76-6" tabindex="-1"></a>         <span class="at">score =</span> <span class="fu">factor</span>(score, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;predicted&quot;</span>, <span class="st">&quot;actual&quot;</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Predicted&quot;</span>, <span class="st">&quot;Actual&quot;</span>)))</span>
<span id="cb76-7"><a href="results.html#cb76-7" tabindex="-1"></a>  </span>
<span id="cb76-8"><a href="results.html#cb76-8" tabindex="-1"></a></span>
<span id="cb76-9"><a href="results.html#cb76-9" tabindex="-1"></a><span class="co"># Subset random subs</span></span>
<span id="cb76-10"><a href="results.html#cb76-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">192</span>)</span>
<span id="cb76-11"><a href="results.html#cb76-11" tabindex="-1"></a>random_subs <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">unique</span>(df_val_phq_combi<span class="sc">$</span>sub_id),<span class="dv">9</span>)</span>
<span id="cb76-12"><a href="results.html#cb76-12" tabindex="-1"></a>df_val_phq_combi <span class="ot">&lt;-</span> df_val_phq_combi[df_val_phq_combi<span class="sc">$</span>sub_id <span class="sc">%in%</span> random_subs,]</span>
<span id="cb76-13"><a href="results.html#cb76-13" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb76-14"><a href="results.html#cb76-14" tabindex="-1"></a><span class="fu">ggplot</span>(df_val_phq_combi, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y=</span>phq, <span class="at">color=</span>score) ) <span class="sc">+</span> </span>
<span id="cb76-15"><a href="results.html#cb76-15" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">&#39;summary&#39;</span>) <span class="sc">+</span> </span>
<span id="cb76-16"><a href="results.html#cb76-16" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept=</span>phq_mean),  <span class="at">linetype=</span><span class="st">&#39;dashed&#39;</span>) <span class="sc">+</span></span>
<span id="cb76-17"><a href="results.html#cb76-17" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sub_id<span class="sc">~</span>predictors) <span class="sc">+</span> </span>
<span id="cb76-18"><a href="results.html#cb76-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;PHQ-9 sum score&quot;</span>, <span class="at">x =</span><span class="st">&quot;Time steps&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-19"><a href="results.html#cb76-19" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb76-20"><a href="results.html#cb76-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>, <span class="at">legend.title =</span><span class="fu">element_blank</span>(), </span>
<span id="cb76-21"><a href="results.html#cb76-21" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">32</span>),  <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">22</span>))  </span></code></pre></div>
<pre><code>## Warning: Removed 90 rows containing non-finite outside the scale range (`stat_summary()`).</code></pre>
<pre><code>## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`</code></pre>
<p><img src="final_report_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="results.html#cb79-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_1_weekly_unlagged.svg&quot;</span>, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">22</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>svglite<span class="sc">::</span>svglite)</span></code></pre></div>
<pre><code>## Warning: Removed 90 rows containing non-finite outside the scale range (`stat_summary()`).</code></pre>
<pre><code>## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="results.html#cb82-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../figures/sm_figure_1_weekly_unlagged.png&quot;</span>, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">18</span>, <span class="at">height=</span><span class="dv">22</span>, <span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="at">device=</span>ragg<span class="sc">::</span>agg_png)</span></code></pre></div>
<pre><code>## Warning: Removed 90 rows containing non-finite outside the scale range (`stat_summary()`).</code></pre>
<pre><code>## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`
## No summary function supplied, defaulting to `mean_se()`</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-testing.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
